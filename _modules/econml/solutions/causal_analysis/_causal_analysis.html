<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>econml.solutions.causal_analysis._causal_analysis &mdash; econml 0.16.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=fd3f3429" />

  
    <link rel="shortcut icon" href="../../../../_static/econml.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=7de89ed4"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            econml
              <img src="../../../../_static/econml-logo-inverse.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.16.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../spec/spec.html">EconML User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/motivation.html">Machine Learning Based Estimation of Heterogeneous Treatment Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/motivation.html#motivating-examples">Motivating Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/motivation.html#recommendation-a-b-testing">Recommendation A/B testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/motivation.html#customer-segmentation">Customer Segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/motivation.html#multi-investment-attribution">Multi-investment Attribution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/causal_intro.html">Introduction to Causal Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/api.html">Problem Setup and API Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/api.html#api-of-conditional-average-treatment-effect-package">API of Conditional Average Treatment Effect Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/api.html#linear-in-treatment-cate-estimators">Linear in Treatment CATE Estimators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/api.html#example-use-of-api">Example Use of API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/flowchart.html">Library Flow Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/comparison.html">Detailed estimator comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/estimation.html">Estimation Methods under Unconfoundedness</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/estimation/dml.html">Orthogonal/Double Machine Learning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dml.html#what-is-it">What is it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dml.html#what-are-the-relevant-estimator-classes">What are the relevant estimator classes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dml.html#when-should-you-use-it">When should you use it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dml.html#overview-of-formal-methodology">Overview of Formal Methodology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dml.html#class-hierarchy-structure">Class Hierarchy Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dml.html#usage-faqs">Usage FAQs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dml.html#usage-examples">Usage Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/estimation/dr.html">Doubly Robust Learning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dr.html#what-is-it">What is it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dr.html#what-are-the-relevant-estimator-classes">What are the relevant estimator classes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dr.html#when-should-you-use-it">When should you use it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dr.html#overview-of-formal-methodology">Overview of Formal Methodology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dr.html#class-hierarchy-structure">Class Hierarchy Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dr.html#usage-faqs">Usage FAQs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dr.html#usage-examples">Usage Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/estimation/forest.html">Forest Based Estimators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/forest.html#what-is-it">What is it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/forest.html#what-are-the-relevant-estimator-classes">What are the relevant estimator classes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/forest.html#when-should-you-use-it">When should you use it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/forest.html#overview-of-formal-methodology">Overview of Formal Methodology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/forest.html#class-hierarchy-structure">Class Hierarchy Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/forest.html#usage-examples">Usage Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/estimation/metalearners.html">Meta-Learners</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/metalearners.html#what-is-it">What is it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/metalearners.html#what-are-the-relevant-estimator-classes">What are the relevant estimator classes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/metalearners.html#when-should-you-use-it">When should you use it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/metalearners.html#overview-of-formal-methodology">Overview of Formal Methodology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/metalearners.html#class-hierarchy-structure">Class Hierarchy Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/metalearners.html#usage-examples">Usage Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/estimation_iv.html">Estimation Methods with Instruments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/estimation/two_sls.html">Sieve 2SLS Instrumental Variable Estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/estimation/orthoiv.html">Orthogonal instrumental variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/orthoiv.html#what-is-it">What is it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/orthoiv.html#what-are-the-relevant-estimator-classes">What are the relevant estimator classes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/orthoiv.html#when-should-you-use-it">When should you use it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/orthoiv.html#class-hierarchy-structure">Class Hierarchy Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/orthoiv.html#usage-examples">Usage Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/estimation_dynamic.html">Estimation Methods for Dynamic Treatment Regimes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/estimation/dynamic_dml.html">Dynamic Double Machine Learning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dynamic_dml.html#what-is-it">What is it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dynamic_dml.html#what-are-the-relevant-estimator-classes">What are the relevant estimator classes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dynamic_dml.html#when-should-you-use-it">When should you use it?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dynamic_dml.html#class-hierarchy-structure">Class Hierarchy Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/estimation/dynamic_dml.html#usage-faqs">Usage FAQs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/inference.html">Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/inference.html#bootstrap-inference">Bootstrap Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/inference.html#ols-inference">OLS Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/inference.html#debiased-lasso-inference">Debiased Lasso Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/inference.html#subsampled-honest-forest-inference">Subsampled Honest Forest Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/inference.html#orthoforest-bootstrap-of-little-bags-inference">OrthoForest Bootstrap of Little Bags Inference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/model_selection.html">Model Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/validation.html">Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/validation.html#sensitivity-analysis">Sensitivity Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/validation.html#drtester">DRTester</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/validation.html#scoring">Scoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/validation.html#confidence-intervals-and-inference">Confidence Intervals and Inference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/validation.html#dowhy-refutation-tests">DoWhy Refutation Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/interpretability.html">Interpretability</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/interpretability.html#tree-interpreter">Tree Interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/interpretability.html#policy-interpreter">Policy Interpreter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/interpretability.html#shap">SHAP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/federated_learning.html">Federated Learning in EconML</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/federated_learning.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/federated_learning.html#motivation-for-incorporating-federated-learning-into-the-econml-library">Motivation for Incorporating Federated Learning into the EconML Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/federated_learning.html#federated-learning-with-econml">Federated Learning with EconML</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/federated_learning.html#introducing-the-federatedestimator">Introducing the <cite>FederatedEstimator</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../spec/federated_learning.html#example-usage">Example Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/federated_learning.html#theory">Theory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/references.html">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/faq.html">Frequently Asked Questions (FAQ)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/faq.html#when-should-i-use-econml">When should I use EconML?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/faq.html#what-are-the-advantages-of-econml">What are the advantages of EconML?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/faq.html#how-do-i-know-if-the-results-make-sense">How do I know if the results make sense?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/faq.html#i-m-getting-causal-estimates-that-don-t-make-sense-what-next">I’m getting causal estimates that don’t make sense. What next?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/faq.html#what-if-i-don-t-have-a-good-instrument-can-t-run-an-experiment-and-don-t-observe-all-confounders">What if I don’t have a good instrument, can’t run an experiment, and don’t observe all confounders?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/faq.html#how-can-i-test-whether-i-m-identifying-the-causal-effect">How can I test whether I’m identifying the causal effect?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../spec/faq.html#how-do-i-give-feedback">How do I give feedback?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../spec/community.html">Community</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference.html">Public Module Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#cate-estimators">CATE Estimators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#double-machine-learning-dml">Double Machine Learning (DML)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml.DML.html">econml.dml.DML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml.LinearDML.html">econml.dml.LinearDML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml.SparseLinearDML.html">econml.dml.SparseLinearDML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml.CausalForestDML.html">econml.dml.CausalForestDML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml.NonParamDML.html">econml.dml.NonParamDML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml.KernelDML.html">econml.dml.KernelDML</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#doubly-robust-dr">Doubly Robust (DR)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dr.DRLearner.html">econml.dr.DRLearner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dr.LinearDRLearner.html">econml.dr.LinearDRLearner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dr.SparseLinearDRLearner.html">econml.dr.SparseLinearDRLearner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dr.ForestDRLearner.html">econml.dr.ForestDRLearner</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#meta-learners">Meta-Learners</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.metalearners.XLearner.html">econml.metalearners.XLearner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.metalearners.TLearner.html">econml.metalearners.TLearner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.metalearners.SLearner.html">econml.metalearners.SLearner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.metalearners.DomainAdaptationLearner.html">econml.metalearners.DomainAdaptationLearner</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#orthogonal-random-forest-orf">Orthogonal Random Forest (ORF)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.orf.DMLOrthoForest.html">econml.orf.DMLOrthoForest</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.orf.DROrthoForest.html">econml.orf.DROrthoForest</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#instrumental-variable-cate-estimators">Instrumental Variable CATE Estimators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#double-machine-learning-dml-iv">Double Machine Learning (DML) IV</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dml.OrthoIV.html">econml.iv.dml.OrthoIV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dml.DMLIV.html">econml.iv.dml.DMLIV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dml.NonParamDMLIV.html">econml.iv.dml.NonParamDMLIV</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#doubly-robust-dr-iv">Doubly Robust (DR) IV</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dr.DRIV.html">econml.iv.dr.DRIV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dr.LinearDRIV.html">econml.iv.dr.LinearDRIV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dr.SparseLinearDRIV.html">econml.iv.dr.SparseLinearDRIV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dr.ForestDRIV.html">econml.iv.dr.ForestDRIV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dr.IntentToTreatDRIV.html">econml.iv.dr.IntentToTreatDRIV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.dr.LinearIntentToTreatDRIV.html">econml.iv.dr.LinearIntentToTreatDRIV</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#sieve-methods">Sieve Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.sieve.SieveTSLS.html">econml.iv.sieve.SieveTSLS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.sieve.HermiteFeatures.html">econml.iv.sieve.HermiteFeatures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.iv.sieve.DPolynomialFeatures.html">econml.iv.sieve.DPolynomialFeatures</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#estimators-for-panel-data">Estimators for Panel Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#dynamic-double-machine-learning">Dynamic Double Machine Learning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.panel.dml.DynamicDML.html">econml.panel.dml.DynamicDML</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#policy-learning">Policy Learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.policy.DRPolicyForest.html">econml.policy.DRPolicyForest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.policy.DRPolicyForest.html#econml.policy.DRPolicyForest"><code class="docutils literal notranslate"><span class="pre">DRPolicyForest</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.policy.DRPolicyTree.html">econml.policy.DRPolicyTree</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.policy.DRPolicyTree.html#econml.policy.DRPolicyTree"><code class="docutils literal notranslate"><span class="pre">DRPolicyTree</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.policy.PolicyForest.html">econml.policy.PolicyForest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.policy.PolicyForest.html#econml.policy.PolicyForest"><code class="docutils literal notranslate"><span class="pre">PolicyForest</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.policy.PolicyTree.html">econml.policy.PolicyTree</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.policy.PolicyTree.html#econml.policy.PolicyTree"><code class="docutils literal notranslate"><span class="pre">PolicyTree</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#cate-interpreters">CATE Interpreters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.cate_interpreter.SingleTreeCateInterpreter.html">econml.cate_interpreter.SingleTreeCateInterpreter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.cate_interpreter.SingleTreeCateInterpreter.html#econml.cate_interpreter.SingleTreeCateInterpreter"><code class="docutils literal notranslate"><span class="pre">SingleTreeCateInterpreter</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.cate_interpreter.SingleTreePolicyInterpreter.html">econml.cate_interpreter.SingleTreePolicyInterpreter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.cate_interpreter.SingleTreePolicyInterpreter.html#econml.cate_interpreter.SingleTreePolicyInterpreter"><code class="docutils literal notranslate"><span class="pre">SingleTreePolicyInterpreter</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#cate-validation">CATE Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.validate.DRTester.html">econml.validate.DRTester</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.validate.DRTester.html#econml.validate.DRTester"><code class="docutils literal notranslate"><span class="pre">DRTester</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.validate.BLPEvaluationResults.html">econml.validate.BLPEvaluationResults</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.validate.BLPEvaluationResults.html#econml.validate.BLPEvaluationResults"><code class="docutils literal notranslate"><span class="pre">BLPEvaluationResults</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.validate.CalibrationEvaluationResults.html">econml.validate.CalibrationEvaluationResults</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.validate.CalibrationEvaluationResults.html#econml.validate.CalibrationEvaluationResults"><code class="docutils literal notranslate"><span class="pre">CalibrationEvaluationResults</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.validate.UpliftEvaluationResults.html">econml.validate.UpliftEvaluationResults</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.validate.UpliftEvaluationResults.html#econml.validate.UpliftEvaluationResults"><code class="docutils literal notranslate"><span class="pre">UpliftEvaluationResults</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.validate.EvaluationResults.html">econml.validate.EvaluationResults</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.validate.EvaluationResults.html#econml.validate.EvaluationResults"><code class="docutils literal notranslate"><span class="pre">EvaluationResults</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#cate-scorers">CATE Scorers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.score.RScorer.html">econml.score.RScorer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.score.RScorer.html#econml.score.RScorer"><code class="docutils literal notranslate"><span class="pre">RScorer</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.score.EnsembleCateEstimator.html">econml.score.EnsembleCateEstimator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.score.EnsembleCateEstimator.html#econml.score.EnsembleCateEstimator"><code class="docutils literal notranslate"><span class="pre">EnsembleCateEstimator</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#generalized-random-forests">Generalized Random Forests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf.CausalForest.html">econml.grf.CausalForest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf.CausalForest.html#econml.grf.CausalForest"><code class="docutils literal notranslate"><span class="pre">CausalForest</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf.CausalIVForest.html">econml.grf.CausalIVForest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf.CausalIVForest.html#econml.grf.CausalIVForest"><code class="docutils literal notranslate"><span class="pre">CausalIVForest</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf.RegressionForest.html">econml.grf.RegressionForest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf.RegressionForest.html#econml.grf.RegressionForest"><code class="docutils literal notranslate"><span class="pre">RegressionForest</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf.MultiOutputGRF.html">econml.grf.MultiOutputGRF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf.MultiOutputGRF.html#econml.grf.MultiOutputGRF"><code class="docutils literal notranslate"><span class="pre">MultiOutputGRF</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf.LinearMomentGRFCriterion.html">econml.grf.LinearMomentGRFCriterion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf.LinearMomentGRFCriterion.html#econml.grf.LinearMomentGRFCriterion"><code class="docutils literal notranslate"><span class="pre">LinearMomentGRFCriterion</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf.LinearMomentGRFCriterionMSE.html">econml.grf.LinearMomentGRFCriterionMSE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf.LinearMomentGRFCriterionMSE.html#econml.grf.LinearMomentGRFCriterionMSE"><code class="docutils literal notranslate"><span class="pre">LinearMomentGRFCriterionMSE</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf._base_grf.BaseGRF.html">econml.grf._base_grf.BaseGRF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf._base_grf.BaseGRF.html#econml.grf._base_grf.BaseGRF"><code class="docutils literal notranslate"><span class="pre">BaseGRF</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.grf._base_grftree.GRFTree.html">econml.grf._base_grftree.GRFTree</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.grf._base_grftree.GRFTree.html#econml.grf._base_grftree.GRFTree"><code class="docutils literal notranslate"><span class="pre">GRFTree</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#scikit-learn-extensions">Scikit-Learn Extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#linear-model-extensions">Linear Model Extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.DebiasedLasso.html">econml.sklearn_extensions.linear_model.DebiasedLasso</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.MultiOutputDebiasedLasso.html">econml.sklearn_extensions.linear_model.MultiOutputDebiasedLasso</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.SelectiveRegularization.html">econml.sklearn_extensions.linear_model.SelectiveRegularization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.StatsModelsLinearRegression.html">econml.sklearn_extensions.linear_model.StatsModelsLinearRegression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.StatsModelsRLM.html">econml.sklearn_extensions.linear_model.StatsModelsRLM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.WeightedLasso.html">econml.sklearn_extensions.linear_model.WeightedLasso</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.WeightedLassoCV.html">econml.sklearn_extensions.linear_model.WeightedLassoCV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.WeightedMultiTaskLassoCV.html">econml.sklearn_extensions.linear_model.WeightedMultiTaskLassoCV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.linear_model.WeightedLassoCVWrapper.html">econml.sklearn_extensions.linear_model.WeightedLassoCVWrapper</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#model-selection-extensions">Model Selection Extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.model_selection.GridSearchCVList.html">econml.sklearn_extensions.model_selection.GridSearchCVList</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.model_selection.WeightedKFold.html">econml.sklearn_extensions.model_selection.WeightedKFold</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.sklearn_extensions.model_selection.WeightedStratifiedKFold.html">econml.sklearn_extensions.model_selection.WeightedStratifiedKFold</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#inference">Inference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#inference-results">Inference Results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.NormalInferenceResults.html">econml.inference.NormalInferenceResults</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.EmpiricalInferenceResults.html">econml.inference.EmpiricalInferenceResults</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.PopulationSummaryResults.html">econml.inference.PopulationSummaryResults</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#inference-methods">Inference Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.BootstrapInference.html">econml.inference.BootstrapInference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.GenericModelFinalInference.html">econml.inference.GenericModelFinalInference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.GenericSingleTreatmentModelFinalInference.html">econml.inference.GenericSingleTreatmentModelFinalInference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.LinearModelFinalInference.html">econml.inference.LinearModelFinalInference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.StatsModelsInference.html">econml.inference.StatsModelsInference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.GenericModelFinalInferenceDiscrete.html">econml.inference.GenericModelFinalInferenceDiscrete</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.LinearModelFinalInferenceDiscrete.html">econml.inference.LinearModelFinalInferenceDiscrete</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference.StatsModelsInferenceDiscrete.html">econml.inference.StatsModelsInferenceDiscrete</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#federated-estimation">Federated Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.federated_learning.FederatedEstimator.html">econml.federated_learning.FederatedEstimator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.federated_learning.FederatedEstimator.html#econml.federated_learning.FederatedEstimator"><code class="docutils literal notranslate"><span class="pre">FederatedEstimator</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#solutions">Solutions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../reference.html#causal-analysis">Causal Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html">econml.solutions.causal_analysis.CausalAnalysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#integration-with-dowhy">Integration with DoWhy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.dowhy.DoWhyWrapper.html">econml.dowhy.DoWhyWrapper</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dowhy.DoWhyWrapper.html#econml.dowhy.DoWhyWrapper"><code class="docutils literal notranslate"><span class="pre">DoWhyWrapper</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference.html#utilities">Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html">econml.utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.IdentityFeatures"><code class="docutils literal notranslate"><span class="pre">IdentityFeatures</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.MissingModule"><code class="docutils literal notranslate"><span class="pre">MissingModule</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.MultiModelWrapper"><code class="docutils literal notranslate"><span class="pre">MultiModelWrapper</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.SeparateModel"><code class="docutils literal notranslate"><span class="pre">SeparateModel</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.Summary"><code class="docutils literal notranslate"><span class="pre">Summary</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.WeightedModelWrapper"><code class="docutils literal notranslate"><span class="pre">WeightedModelWrapper</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.add_intercept"><code class="docutils literal notranslate"><span class="pre">add_intercept()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.broadcast_unit_treatments"><code class="docutils literal notranslate"><span class="pre">broadcast_unit_treatments()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.check_input_arrays"><code class="docutils literal notranslate"><span class="pre">check_input_arrays()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.check_inputs"><code class="docutils literal notranslate"><span class="pre">check_inputs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.check_models"><code class="docutils literal notranslate"><span class="pre">check_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.concatenate"><code class="docutils literal notranslate"><span class="pre">concatenate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.cross_product"><code class="docutils literal notranslate"><span class="pre">cross_product()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.deprecated"><code class="docutils literal notranslate"><span class="pre">deprecated()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.einsum_sparse"><code class="docutils literal notranslate"><span class="pre">einsum_sparse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.filter_none_kwargs"><code class="docutils literal notranslate"><span class="pre">filter_none_kwargs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.get_feature_names_or_default"><code class="docutils literal notranslate"><span class="pre">get_feature_names_or_default()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.get_input_columns"><code class="docutils literal notranslate"><span class="pre">get_input_columns()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.hstack"><code class="docutils literal notranslate"><span class="pre">hstack()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.inverse_onehot"><code class="docutils literal notranslate"><span class="pre">inverse_onehot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.iscoo"><code class="docutils literal notranslate"><span class="pre">iscoo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.issparse"><code class="docutils literal notranslate"><span class="pre">issparse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.jacify_featurizer"><code class="docutils literal notranslate"><span class="pre">jacify_featurizer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.ndim"><code class="docutils literal notranslate"><span class="pre">ndim()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.one_hot_encoder"><code class="docutils literal notranslate"><span class="pre">one_hot_encoder()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.reshape"><code class="docutils literal notranslate"><span class="pre">reshape()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.reshape_Y_T"><code class="docutils literal notranslate"><span class="pre">reshape_Y_T()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.reshape_arrays_2dim"><code class="docutils literal notranslate"><span class="pre">reshape_arrays_2dim()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.reshape_outcomewise_effects"><code class="docutils literal notranslate"><span class="pre">reshape_outcomewise_effects()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.reshape_treatmentwise_effects"><code class="docutils literal notranslate"><span class="pre">reshape_treatmentwise_effects()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.shape"><code class="docutils literal notranslate"><span class="pre">shape()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.size"><code class="docutils literal notranslate"><span class="pre">size()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.stack"><code class="docutils literal notranslate"><span class="pre">stack()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.strata_from_discrete_arrays"><code class="docutils literal notranslate"><span class="pre">strata_from_discrete_arrays()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.tensordot"><code class="docutils literal notranslate"><span class="pre">tensordot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.tocoo"><code class="docutils literal notranslate"><span class="pre">tocoo()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.todense"><code class="docutils literal notranslate"><span class="pre">todense()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.transpose"><code class="docutils literal notranslate"><span class="pre">transpose()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.transpose_dictionary"><code class="docutils literal notranslate"><span class="pre">transpose_dictionary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.utilities.html#econml.utilities.vstack"><code class="docutils literal notranslate"><span class="pre">vstack()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference.html#private-module-reference">Private Module Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html">econml._ortho_learner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues"><code class="docutils literal notranslate"><span class="pre">CachedValues</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.count"><code class="docutils literal notranslate"><span class="pre">CachedValues.count()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.index"><code class="docutils literal notranslate"><span class="pre">CachedValues.index()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.T"><code class="docutils literal notranslate"><span class="pre">CachedValues.T</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.W"><code class="docutils literal notranslate"><span class="pre">CachedValues.W</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.X"><code class="docutils literal notranslate"><span class="pre">CachedValues.X</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.Y"><code class="docutils literal notranslate"><span class="pre">CachedValues.Y</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.Z"><code class="docutils literal notranslate"><span class="pre">CachedValues.Z</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.freq_weight"><code class="docutils literal notranslate"><span class="pre">CachedValues.freq_weight</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.groups"><code class="docutils literal notranslate"><span class="pre">CachedValues.groups</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.nuisances"><code class="docutils literal notranslate"><span class="pre">CachedValues.nuisances</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.sample_var"><code class="docutils literal notranslate"><span class="pre">CachedValues.sample_var</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner.CachedValues.sample_weight"><code class="docutils literal notranslate"><span class="pre">CachedValues.sample_weight</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.models_nuisance_"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.models_nuisance_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.ortho_learner_model_final_"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.ortho_learner_model_final_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.score_"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.score_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.nuisance_scores_"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.nuisance_scores_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.ate"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.ate_inference"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.ate_interval"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.cate_output_names"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.const_marginal_ate"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.const_marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.const_marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.const_marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.const_marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.const_marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.const_marginal_effect"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.const_marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.const_marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.const_marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.const_marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.const_marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.effect"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.effect_inference"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.effect_interval"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.fit"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.marginal_ate"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.marginal_effect"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.refit_final"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.refit_final()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.score"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.score()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.shap_values"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.shap_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._OrthoLearner.dowhy"><code class="docutils literal notranslate"><span class="pre">_OrthoLearner.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._ortho_learner.html#econml._ortho_learner._crossfit"><code class="docutils literal notranslate"><span class="pre">_crossfit()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html">econml._cate_estimator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.ate"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.ate_inference"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.ate_interval"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.cate_output_names"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.effect"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.effect_inference"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.effect_interval"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.fit"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.marginal_ate"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.marginal_effect"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.BaseCateEstimator.dowhy"><code class="docutils literal notranslate"><span class="pre">BaseCateEstimator.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.ate"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.coef_"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.coef_()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.coef__inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.coef__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.coef__interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.coef__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.effect"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.fit"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.intercept_"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.intercept_()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.intercept__inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.intercept__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.intercept__interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.intercept__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.summary"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.summary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorDiscreteMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorDiscreteMixin.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.ate"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.coef__inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.coef__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.coef__interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.coef__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.effect"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.fit"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.intercept__inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.intercept__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.intercept__interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.intercept__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.shap_values"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.shap_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.summary"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.summary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.coef_"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.coef_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.dowhy</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.DebiasedLassoCateEstimatorMixin.intercept_"><code class="docutils literal notranslate"><span class="pre">DebiasedLassoCateEstimatorMixin.intercept_</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.ate"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.effect"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.fit"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorDiscreteMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorDiscreteMixin.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.ate"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.effect"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.fit"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.ForestModelFinalCateEstimatorMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">ForestModelFinalCateEstimatorMixin.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.ate"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.ate_inference"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.ate_interval"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.cate_output_names"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.const_marginal_ate"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.const_marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.const_marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.const_marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.const_marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.const_marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.const_marginal_effect"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.const_marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.const_marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.const_marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.const_marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.const_marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.effect"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.effect_inference"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.effect_interval"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.fit"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.marginal_ate"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.marginal_effect"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.shap_values"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.shap_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearCateEstimator.dowhy"><code class="docutils literal notranslate"><span class="pre">LinearCateEstimator.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.ate"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.coef_"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.coef_()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.coef__inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.coef__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.coef__interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.coef__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.effect"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.fit"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.intercept_"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.intercept_()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.intercept__inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.intercept__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.intercept__interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.intercept__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.summary"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.summary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorDiscreteMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorDiscreteMixin.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.bias_part_of_coef"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.bias_part_of_coef</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.ate"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.coef__inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.coef__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.coef__interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.coef__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.effect"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.fit"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.intercept__inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.intercept__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.intercept__interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.intercept__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.shap_values"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.shap_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.summary"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.summary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.coef_"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.coef_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.dowhy</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.LinearModelFinalCateEstimatorMixin.intercept_"><code class="docutils literal notranslate"><span class="pre">LinearModelFinalCateEstimatorMixin.intercept_</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.ate"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.coef_"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.coef_()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.coef__inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.coef__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.coef__interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.coef__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.effect"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.fit"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.intercept_"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.intercept_()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.intercept__inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.intercept__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.intercept__interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.intercept__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.summary"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.summary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorDiscreteMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorDiscreteMixin.dowhy</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.ate"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.coef__inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.coef__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.coef__interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.coef__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.effect"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.fit"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.intercept__inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.intercept__inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.intercept__interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.intercept__interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.shap_values"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.shap_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.summary"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.summary()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.coef_"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.coef_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.dowhy</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.StatsModelsCateEstimatorMixin.intercept_"><code class="docutils literal notranslate"><span class="pre">StatsModelsCateEstimatorMixin.intercept_</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.ate"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.ate_inference"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.ate_interval"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.cate_output_names"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.effect"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.effect_inference"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.effect_interval"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.fit"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.marginal_ate"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.marginal_effect"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml._cate_estimator.html#econml._cate_estimator.TreatmentExpansionMixin.dowhy"><code class="docutils literal notranslate"><span class="pre">TreatmentExpansionMixin.dowhy</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html">econml.dml._rlearner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner"><code class="docutils literal notranslate"><span class="pre">_RLearner</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.models_y"><code class="docutils literal notranslate"><span class="pre">_RLearner.models_y</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.models_t"><code class="docutils literal notranslate"><span class="pre">_RLearner.models_t</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.rlearner_model_final_"><code class="docutils literal notranslate"><span class="pre">_RLearner.rlearner_model_final_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.score_"><code class="docutils literal notranslate"><span class="pre">_RLearner.score_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.nuisance_scores_y"><code class="docutils literal notranslate"><span class="pre">_RLearner.nuisance_scores_y</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.nuisance_scores_t"><code class="docutils literal notranslate"><span class="pre">_RLearner.nuisance_scores_t</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.ate"><code class="docutils literal notranslate"><span class="pre">_RLearner.ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.ate_inference"><code class="docutils literal notranslate"><span class="pre">_RLearner.ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.ate_interval"><code class="docutils literal notranslate"><span class="pre">_RLearner.ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.cate_feature_names"><code class="docutils literal notranslate"><span class="pre">_RLearner.cate_feature_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.cate_output_names"><code class="docutils literal notranslate"><span class="pre">_RLearner.cate_output_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.cate_treatment_names"><code class="docutils literal notranslate"><span class="pre">_RLearner.cate_treatment_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.const_marginal_ate"><code class="docutils literal notranslate"><span class="pre">_RLearner.const_marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.const_marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">_RLearner.const_marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.const_marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">_RLearner.const_marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.const_marginal_effect"><code class="docutils literal notranslate"><span class="pre">_RLearner.const_marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.const_marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">_RLearner.const_marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.const_marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">_RLearner.const_marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.effect"><code class="docutils literal notranslate"><span class="pre">_RLearner.effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.effect_inference"><code class="docutils literal notranslate"><span class="pre">_RLearner.effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.effect_interval"><code class="docutils literal notranslate"><span class="pre">_RLearner.effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.fit"><code class="docutils literal notranslate"><span class="pre">_RLearner.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.marginal_ate"><code class="docutils literal notranslate"><span class="pre">_RLearner.marginal_ate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.marginal_ate_inference"><code class="docutils literal notranslate"><span class="pre">_RLearner.marginal_ate_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.marginal_ate_interval"><code class="docutils literal notranslate"><span class="pre">_RLearner.marginal_ate_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.marginal_effect"><code class="docutils literal notranslate"><span class="pre">_RLearner.marginal_effect()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.marginal_effect_inference"><code class="docutils literal notranslate"><span class="pre">_RLearner.marginal_effect_inference()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.marginal_effect_interval"><code class="docutils literal notranslate"><span class="pre">_RLearner.marginal_effect_interval()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.refit_final"><code class="docutils literal notranslate"><span class="pre">_RLearner.refit_final()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.score"><code class="docutils literal notranslate"><span class="pre">_RLearner.score()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.score_nuisances"><code class="docutils literal notranslate"><span class="pre">_RLearner.score_nuisances()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.shap_values"><code class="docutils literal notranslate"><span class="pre">_RLearner.shap_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.dowhy"><code class="docutils literal notranslate"><span class="pre">_RLearner.dowhy</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.dml._rlearner.html#econml.dml._rlearner._RLearner.residuals_"><code class="docutils literal notranslate"><span class="pre">_RLearner.residuals_</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../_autosummary/econml.inference._bootstrap.html">econml.inference._bootstrap</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../_autosummary/econml.inference._bootstrap.html#econml.inference._bootstrap.BootstrapEstimator"><code class="docutils literal notranslate"><span class="pre">BootstrapEstimator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../_autosummary/econml.inference._bootstrap.html#econml.inference._bootstrap.BootstrapEstimator.fit"><code class="docutils literal notranslate"><span class="pre">BootstrapEstimator.fit()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">econml</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">econml.solutions.causal_analysis._causal_analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for econml.solutions.causal_analysis._causal_analysis</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) PyWhy contributors. All rights reserved.</span>
<span class="c1"># Licensed under the MIT License.</span>

<span class="sd">&quot;&quot;&quot;Module for assessing causal feature importance.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">namedtuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lightgbm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lgb</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">iterable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">LogisticRegressionCV</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.tree</span><span class="w"> </span><span class="kn">import</span> <span class="n">_tree</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.utils.validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">column_or_1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...cate_interpreter</span><span class="w"> </span><span class="kn">import</span> <span class="n">SingleTreeCateInterpreter</span><span class="p">,</span> <span class="n">SingleTreePolicyInterpreter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...dml</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearDML</span><span class="p">,</span> <span class="n">CausalForestDML</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...inference</span><span class="w"> </span><span class="kn">import</span> <span class="n">NormalInferenceResults</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...sklearn_extensions.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeightedLasso</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...sklearn_extensions.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCVList</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">...utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">_RegressionWrapper</span><span class="p">,</span> <span class="n">get_feature_names_or_default</span><span class="p">,</span> <span class="n">one_hot_encoder</span>

<span class="c1"># TODO: this utility is documented but internal; reimplement?</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">_safe_indexing</span>
<span class="c1"># TODO: this utility is even less public...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn</span>
<span class="k">if</span> <span class="n">parse</span><span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.5&quot;</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">_get_column_indices</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.utils._indexing</span><span class="w"> </span><span class="kn">import</span> <span class="n">_get_column_indices</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_CausalInsightsConstants</span><span class="p">:</span>
    <span class="n">RawFeatureNameKey</span> <span class="o">=</span> <span class="s1">&#39;raw_name&#39;</span>
    <span class="n">EngineeredNameKey</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span>
    <span class="n">CategoricalColumnKey</span> <span class="o">=</span> <span class="s1">&#39;cat&#39;</span>
    <span class="n">TypeKey</span> <span class="o">=</span> <span class="s1">&#39;type&#39;</span>
    <span class="n">PointEstimateKey</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span>
    <span class="n">StandardErrorKey</span> <span class="o">=</span> <span class="s1">&#39;stderr&#39;</span>
    <span class="n">ZStatKey</span> <span class="o">=</span> <span class="s1">&#39;zstat&#39;</span>
    <span class="n">ConfidenceIntervalLowerKey</span> <span class="o">=</span> <span class="s1">&#39;ci_lower&#39;</span>
    <span class="n">ConfidenceIntervalUpperKey</span> <span class="o">=</span> <span class="s1">&#39;ci_upper&#39;</span>
    <span class="n">PValueKey</span> <span class="o">=</span> <span class="s1">&#39;p_value&#39;</span>
    <span class="n">Version</span> <span class="o">=</span> <span class="s1">&#39;version&#39;</span>
    <span class="n">CausalComputationTypeKey</span> <span class="o">=</span> <span class="s1">&#39;causal_computation_type&#39;</span>
    <span class="n">ConfoundingIntervalKey</span> <span class="o">=</span> <span class="s1">&#39;confounding_interval&#39;</span>
    <span class="n">ViewKey</span> <span class="o">=</span> <span class="s1">&#39;view&#39;</span>
    <span class="n">InitArgsKey</span> <span class="o">=</span> <span class="s1">&#39;init_args&#39;</span>
    <span class="n">RowData</span> <span class="o">=</span> <span class="s1">&#39;row_data&#39;</span>  <span class="c1"># NOTE: RowData is mutually exclusive with the other data columns</span>

    <span class="n">ALL</span> <span class="o">=</span> <span class="p">[</span><span class="n">RawFeatureNameKey</span><span class="p">,</span>
           <span class="n">EngineeredNameKey</span><span class="p">,</span>
           <span class="n">CategoricalColumnKey</span><span class="p">,</span>
           <span class="n">TypeKey</span><span class="p">,</span>
           <span class="n">PointEstimateKey</span><span class="p">,</span>
           <span class="n">StandardErrorKey</span><span class="p">,</span>
           <span class="n">ZStatKey</span><span class="p">,</span>
           <span class="n">ConfidenceIntervalLowerKey</span><span class="p">,</span>
           <span class="n">ConfidenceIntervalUpperKey</span><span class="p">,</span>
           <span class="n">PValueKey</span><span class="p">,</span>
           <span class="n">Version</span><span class="p">,</span>
           <span class="n">CausalComputationTypeKey</span><span class="p">,</span>
           <span class="n">ConfoundingIntervalKey</span><span class="p">,</span>
           <span class="n">ViewKey</span><span class="p">,</span>
           <span class="n">InitArgsKey</span><span class="p">,</span>
           <span class="n">RowData</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_default_shared_insights_output</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get dictionary elements shared among all analyses.</span>

<span class="sd">    In case of breaking changes to this dictionary output, the major version of this</span>
<span class="sd">    dictionary should be updated. In case of a change to this dictionary, the minor</span>
<span class="sd">    version should be updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">RawFeatureNameKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">EngineeredNameKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">CategoricalColumnKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">TypeKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">CausalComputationTypeKey</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">,</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfoundingIntervalKey</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">InitArgsKey</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_default_specific_insights</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
    <span class="c1"># keys should be mutually exclusive with shared keys, so that the dictionaries can be cleanly merged</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PointEstimateKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">StandardErrorKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ZStatKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalLowerKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalUpperKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PValueKey</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ViewKey</span><span class="p">:</span> <span class="n">view</span>
    <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_metadata_causal_insights_keys</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">Version</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">CausalComputationTypeKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfoundingIntervalKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ViewKey</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_column_causal_insights_keys</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">RawFeatureNameKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">EngineeredNameKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">CategoricalColumnKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">TypeKey</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_data_causal_insights_keys</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PointEstimateKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">StandardErrorKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ZStatKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalLowerKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalUpperKey</span><span class="p">,</span>
            <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PValueKey</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_first_stage_reg</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">automl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">automl</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">GridSearchCVList</span><span class="p">([</span><span class="n">LassoCV</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
                                  <span class="n">RandomForestRegressor</span><span class="p">(</span>
                                      <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
                                  <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">num_leaves</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)],</span>
                                 <span class="n">param_grid_list</span><span class="o">=</span><span class="p">[{},</span>
                                                  <span class="p">{</span><span class="s1">&#39;min_weight_fraction_leaf&#39;</span><span class="p">:</span>
                                                      <span class="p">[</span><span class="mf">.001</span><span class="p">,</span> <span class="mf">.01</span><span class="p">,</span> <span class="mf">.1</span><span class="p">]},</span>
                                                  <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}],</span>
                                 <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                 <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span>
                                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">best_est</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">best_estimator_</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">best_est</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">best_est</span><span class="o">.</span><span class="n">alpha_</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">best_est</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">alpha_</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_first_stage_clf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">make_regressor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">automl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="c1"># use same Cs as would be used by default by LogisticRegressionCV</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_count</span> <span class="o">=</span> <span class="n">_CAT_LIMIT</span>  <span class="c1"># we have at least this many instances</span>
    <span class="k">if</span> <span class="n">automl</span><span class="p">:</span>
        <span class="c1"># NOTE: we don&#39;t use LogisticRegressionCV inside the grid search because of the nested stratification</span>
        <span class="c1">#       which could affect how many times each distinct Y value needs to be present in the data</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">GridSearchCVList</span><span class="p">([</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                     <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
                                  <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                                         <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
                                  <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">num_leaves</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)],</span>
                                 <span class="n">param_grid_list</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">cs</span><span class="p">},</span>
                                                  <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                                                   <span class="s1">&#39;min_weight_fraction_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.001</span><span class="p">,</span> <span class="mf">.01</span><span class="p">,</span> <span class="mf">.1</span><span class="p">]},</span>
                                                  <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}],</span>
                                 <span class="n">cv</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_count</span><span class="p">),</span>
                                 <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_log_loss&#39;</span><span class="p">,</span>
                                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">est</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">best_estimator_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegressionCV</span><span class="p">(</span>
            <span class="n">cv</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_count</span><span class="p">),</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">Cs</span><span class="o">=</span><span class="n">cs</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">est</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">C_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">make_regressor</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_RegressionWrapper</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">est</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_final_stage</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">GridSearchCVList</span><span class="p">([</span><span class="n">WeightedLasso</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
                             <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)],</span>
                            <span class="n">param_grid_list</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.001</span><span class="p">,</span> <span class="mf">.01</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]},</span>
                                             <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                                              <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">]}],</span>
                            <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


<span class="c1"># simplification of sklearn&#39;s ColumnTransformer that encodes categoricals and passes through selected other columns</span>
<span class="c1"># but also supports get_feature_names with expected signature</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_ColumnTransformer</span><span class="p">(</span><span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">passthrough</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span> <span class="o">=</span> <span class="n">categorical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passthrough</span> <span class="o">=</span> <span class="n">passthrough</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">cat_cols</span> <span class="o">=</span> <span class="n">_safe_indexing</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cat_cols</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_cats</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># NOTE: set handle_unknown to &#39;ignore&#39; so that we don&#39;t throw at runtime if given a novel value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_encoder</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_cats</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_x</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">_safe_indexing</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passthrough</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cats</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">_safe_indexing</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="c1"># NOTE: we rely on the passthrough columns coming first in the concatenated X;W</span>
            <span class="c1">#       when we pipeline scaling with our first stage models later, so the order here is important</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rest</span><span class="p">,</span> <span class="n">cats</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rest</span>

    <span class="c1"># TODO: remove once older sklearn support is no longer needed</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_feature_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_x</span><span class="p">)]</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">_safe_indexing</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passthrough</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cats</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">get_feature_names_or_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_hot_encoder</span><span class="p">,</span> <span class="n">_safe_indexing</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">rest</span><span class="p">,</span> <span class="n">cats</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rest</span>


<span class="c1"># Wrapper to make sure that we get a deep copy of the contents instead of clone returning an untrained copy</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_Wrapper</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_FrozenTransformer</span><span class="p">(</span><span class="n">TransformerMixin</span><span class="p">,</span> <span class="n">BaseEstimator</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapper</span> <span class="o">=</span> <span class="n">wrapper</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapper</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_freeze</span><span class="p">(</span><span class="n">transformer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_FrozenTransformer</span><span class="p">(</span><span class="n">_Wrapper</span><span class="p">(</span><span class="n">transformer</span><span class="p">))</span>


<span class="c1"># Convert python objects to (possibly nested) types that can easily be represented as literals</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_sanitize</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">obj</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">_sanitize</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">_sanitize</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">_sanitize</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not sanitize input </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># Convert SingleTreeInterpreter to a python dictionary</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_tree_interpreter_to_dict</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">leaf_data</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="p">{}):</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">tree_model_</span><span class="o">.</span><span class="n">tree_</span>
    <span class="n">node_dict</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">node_dict_</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recurse</span><span class="p">(</span><span class="n">node_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">children_left</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">_tree</span><span class="o">.</span><span class="n">TREE_LEAF</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;leaf&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;n_samples&#39;</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">n_node_samples</span><span class="p">[</span><span class="n">node_id</span><span class="p">],</span> <span class="o">**</span><span class="n">leaf_data</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">node_dict</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;leaf&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">feature</span><span class="p">[</span><span class="n">node_id</span><span class="p">]],</span> <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">threshold</span><span class="p">[</span><span class="n">node_id</span><span class="p">],</span>
                    <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">recurse</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">children_left</span><span class="p">[</span><span class="n">node_id</span><span class="p">]),</span>
                    <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">recurse</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">children_right</span><span class="p">[</span><span class="n">node_id</span><span class="p">])}</span>

    <span class="k">return</span> <span class="n">recurse</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_PolicyOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A type encapsulating various information related to a learned policy.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tree_dictionary:dict</span>
<span class="sd">        The policy tree represented as a dictionary,</span>
<span class="sd">    policy_value:float</span>
<span class="sd">        The average value of applying the recommended policy (over using the control),</span>
<span class="sd">    always_treat:dict of str to float</span>
<span class="sd">        A dictionary mapping each non-control treatment to the value of always treating with it (over control),</span>
<span class="sd">    control_name:str</span>
<span class="sd">        The name of the control treatment</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree_dictionary</span><span class="p">,</span> <span class="n">policy_value</span><span class="p">,</span> <span class="n">always_treat</span><span class="p">,</span> <span class="n">control_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_dictionary</span> <span class="o">=</span> <span class="n">tree_dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_value</span> <span class="o">=</span> <span class="n">policy_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">always_treat</span> <span class="o">=</span> <span class="n">always_treat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_name</span> <span class="o">=</span> <span class="n">control_name</span>


<span class="c1"># named tuple type for storing results inside CausalAnalysis class;</span>
<span class="c1"># must be lifted to module level to enable pickling</span>
<span class="n">_result</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;_result&quot;</span><span class="p">,</span> <span class="n">field_names</span><span class="o">=</span><span class="p">[</span>
    <span class="s2">&quot;feature_index&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_name&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_levels&quot;</span><span class="p">,</span> <span class="s2">&quot;hinds&quot;</span><span class="p">,</span>
    <span class="s2">&quot;X_transformer&quot;</span><span class="p">,</span> <span class="s2">&quot;W_transformer&quot;</span><span class="p">,</span> <span class="s2">&quot;estimator&quot;</span><span class="p">,</span> <span class="s2">&quot;global_inference&quot;</span><span class="p">,</span> <span class="s2">&quot;treatment_value&quot;</span><span class="p">])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_process_feature</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">feat_ind</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">categorical_inds</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">heterogeneity_inds</span><span class="p">,</span> <span class="n">min_counts</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span>
                     <span class="n">nuisance_models</span><span class="p">,</span> <span class="n">h_model</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">model_y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">mc_iters</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CausalAnalysis: Feature </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">discrete_treatment</span> <span class="o">=</span> <span class="n">feat_ind</span> <span class="ow">in</span> <span class="n">categorical_inds</span>
        <span class="k">if</span> <span class="n">discrete_treatment</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">categories</span><span class="p">[</span><span class="n">categorical_inds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">feat_ind</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>  <span class="c1"># just leave the setting at the default otherwise</span>

        <span class="c1"># the transformation logic here is somewhat tricky; we always need to encode the categorical columns,</span>
        <span class="c1"># whether they end up in X or in W.  However, for the continuous columns, we want to scale them all</span>
        <span class="c1"># when running the first stage models, but don&#39;t want to scale the X columns when running the final model,</span>
        <span class="c1"># since then our coefficients will have odd units and our trees will also have decisions using those units.</span>
        <span class="c1">#</span>
        <span class="c1"># we achieve this by pipelining the X scaling with the Y and T models (with fixed scaling, not refitting)</span>

        <span class="n">hinds</span> <span class="o">=</span> <span class="n">heterogeneity_inds</span><span class="p">[</span><span class="n">feat_ind</span><span class="p">]</span>
        <span class="n">WX_transformer</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([(</span><span class="s1">&#39;encode&#39;</span><span class="p">,</span> <span class="n">one_hot_encoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">),</span>
                                             <span class="p">[</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">categorical_inds</span>
                                              <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="n">feat_ind</span><span class="p">]),</span>
                                            <span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="n">feat_ind</span><span class="p">)],</span>
                                           <span class="n">remainder</span><span class="o">=</span><span class="n">StandardScaler</span><span class="p">())</span>
        <span class="n">W_transformer</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([(</span><span class="s1">&#39;encode&#39;</span><span class="p">,</span> <span class="n">one_hot_encoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">),</span>
                                            <span class="p">[</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">categorical_inds</span>
                                             <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="n">feat_ind</span> <span class="ow">and</span> <span class="n">ind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hinds</span><span class="p">]),</span>
                                           <span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="n">hinds</span><span class="p">),</span>
                                           <span class="p">(</span><span class="s1">&#39;drop_feat&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="n">feat_ind</span><span class="p">)],</span>
                                          <span class="n">remainder</span><span class="o">=</span><span class="n">StandardScaler</span><span class="p">())</span>

        <span class="n">X_cont_inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">hinds</span>
                       <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="n">feat_ind</span> <span class="ow">and</span> <span class="n">ind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categorical_inds</span><span class="p">]</span>

        <span class="c1"># Use _ColumnTransformer instead of ColumnTransformer so we can get feature names</span>
        <span class="n">X_transformer</span> <span class="o">=</span> <span class="n">_ColumnTransformer</span><span class="p">([</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">categorical_inds</span>
                                            <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="n">feat_ind</span> <span class="ow">and</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">hinds</span><span class="p">],</span>
                                           <span class="n">X_cont_inds</span><span class="p">)</span>

        <span class="c1"># Controls are all other columns of X</span>
        <span class="n">WX</span> <span class="o">=</span> <span class="n">WX_transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="c1"># can&#39;t use X[:, feat_ind] when X is a DataFrame</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">_safe_indexing</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">feat_ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># TODO: we can&#39;t currently handle unseen values of the feature column when getting the effect;</span>
        <span class="c1">#       we might want to modify OrthoLearner (and other discrete treatment classes)</span>
        <span class="c1">#       so that the user can opt-in to allowing unseen treatment values</span>
        <span class="c1">#       (and return NaN or something in that case)</span>

        <span class="n">W</span> <span class="o">=</span> <span class="n">W_transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X_xf</span> <span class="o">=</span> <span class="n">X_transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># HACK: this is slightly ugly because we rely on the fact that DML passes [X;W] to the first stage models</span>
        <span class="c1">#       and so we can just peel the first columns off of that combined array for rescaling in the pipeline</span>
        <span class="c1"># TODO: consider addding an API to DML that allows for better understanding of how the nuisance inputs are</span>
        <span class="c1">#       built, such as model_y_feature_names, model_t_feature_names, model_y_transformer, etc., so that this</span>
        <span class="c1">#       becomes a valid approach to handling this</span>
        <span class="n">X_scaler</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span>
                                       <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cont_inds</span><span class="p">))))],</span>
                                     <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X_xf</span><span class="p">,</span> <span class="n">W</span><span class="p">]))</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>

        <span class="n">X_scaler_fixed</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">_freeze</span><span class="p">(</span><span class="n">X_scaler</span><span class="p">),</span>
                                             <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cont_inds</span><span class="p">))))],</span>
                                           <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># array checking routines don&#39;t accept 0-width arrays</span>
            <span class="n">W</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">X_xf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X_xf</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CausalAnalysis: performing model selection on T model&quot;</span><span class="p">)</span>

        <span class="c1"># perform model selection</span>
        <span class="n">model_t</span> <span class="o">=</span> <span class="p">(</span><span class="n">_first_stage_clf</span><span class="p">(</span><span class="n">WX</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">automl</span><span class="o">=</span><span class="n">nuisance_models</span> <span class="o">==</span> <span class="s1">&#39;automl&#39;</span><span class="p">,</span>
                                    <span class="n">min_count</span><span class="o">=</span><span class="n">min_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feat_ind</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                    <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                   <span class="k">if</span> <span class="n">discrete_treatment</span> <span class="k">else</span> <span class="n">_first_stage_reg</span><span class="p">(</span><span class="n">WX</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">automl</span><span class="o">=</span><span class="n">nuisance_models</span> <span class="o">==</span> <span class="s1">&#39;automl&#39;</span><span class="p">,</span>
                                                               <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                                                               <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>

        <span class="n">pipelined_model_t</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">X_scaler_fixed</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model_t</span><span class="p">)])</span>

        <span class="n">pipelined_model_y</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">X_scaler_fixed</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model_y</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">X_xf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">h_model</span> <span class="o">==</span> <span class="s1">&#39;forest&#39;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using a linear model instead of a forest model for feature &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                          <span class="s2">&quot;because forests don&#39;t support models with no heterogeneity indices&quot;</span><span class="p">)</span>
            <span class="n">h_model</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>

        <span class="k">if</span> <span class="n">h_model</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">est</span> <span class="o">=</span> <span class="n">LinearDML</span><span class="p">(</span><span class="n">model_y</span><span class="o">=</span><span class="n">pipelined_model_y</span><span class="p">,</span>
                            <span class="n">model_t</span><span class="o">=</span><span class="n">pipelined_model_t</span><span class="p">,</span>
                            <span class="n">discrete_treatment</span><span class="o">=</span><span class="n">discrete_treatment</span><span class="p">,</span>
                            <span class="n">fit_cate_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">categories</span><span class="o">=</span><span class="n">cats</span><span class="p">,</span>
                            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                            <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
                            <span class="n">mc_iters</span><span class="o">=</span><span class="n">mc_iters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">h_model</span> <span class="o">==</span> <span class="s1">&#39;forest&#39;</span><span class="p">:</span>
            <span class="n">est</span> <span class="o">=</span> <span class="n">CausalForestDML</span><span class="p">(</span><span class="n">model_y</span><span class="o">=</span><span class="n">pipelined_model_y</span><span class="p">,</span>
                                  <span class="n">model_t</span><span class="o">=</span><span class="n">pipelined_model_t</span><span class="p">,</span>
                                  <span class="n">discrete_treatment</span><span class="o">=</span><span class="n">discrete_treatment</span><span class="p">,</span>
                                  <span class="n">n_estimators</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
                                  <span class="n">min_var_leaf_on_val</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">categories</span><span class="o">=</span><span class="n">cats</span><span class="p">,</span>
                                  <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                                  <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                  <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
                                  <span class="n">mc_iters</span><span class="o">=</span><span class="n">mc_iters</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CausalAnalysis: tuning forest&quot;</span><span class="p">)</span>
            <span class="n">est</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_xf</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CausalAnalysis: training causal model&quot;</span><span class="p">)</span>
        <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_xf</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">cache_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Prefer ate__inference to const_marginal_ate_inference(X) because it is doubly-robust and not conservative</span>
        <span class="k">if</span> <span class="n">h_model</span> <span class="o">==</span> <span class="s1">&#39;forest&#39;</span> <span class="ow">and</span> <span class="n">discrete_treatment</span><span class="p">:</span>
            <span class="n">global_inference</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">ate__inference</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># convert to NormalInferenceResults for consistency</span>
            <span class="n">inf</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">const_marginal_ate_inference</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_xf</span><span class="p">)</span>
            <span class="n">global_inference</span> <span class="o">=</span> <span class="n">NormalInferenceResults</span><span class="p">(</span><span class="n">d_t</span><span class="o">=</span><span class="n">inf</span><span class="o">.</span><span class="n">d_t</span><span class="p">,</span> <span class="n">d_y</span><span class="o">=</span><span class="n">inf</span><span class="o">.</span><span class="n">d_y</span><span class="p">,</span>
                                                      <span class="n">pred</span><span class="o">=</span><span class="n">inf</span><span class="o">.</span><span class="n">mean_point</span><span class="p">,</span>
                                                      <span class="n">pred_stderr</span><span class="o">=</span><span class="n">inf</span><span class="o">.</span><span class="n">stderr_mean</span><span class="p">,</span>
                                                      <span class="n">mean_pred_stderr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                      <span class="n">inf_type</span><span class="o">=</span><span class="s1">&#39;ate&#39;</span><span class="p">)</span>

        <span class="c1"># Set the dictionary values shared between local and global summaries</span>
        <span class="k">if</span> <span class="n">discrete_treatment</span><span class="p">:</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">categories_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="n">cats</span><span class="p">[</span><span class="n">est</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">drop_idx_</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="n">cats</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">)),</span>
                                     <span class="n">est</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">drop_idx_</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="n">d_t</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
            <span class="n">insights</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">TypeKey</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_t</span><span class="p">,</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">RawFeatureNameKey</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_t</span><span class="p">,</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">CategoricalColumnKey</span><span class="p">:</span> <span class="n">cats</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">EngineeredNameKey</span><span class="p">:</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (base=</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="n">treatment_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_t</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">]</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">insights</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">TypeKey</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">],</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">RawFeatureNameKey</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">],</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">CategoricalColumnKey</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">],</span>
                <span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">EngineeredNameKey</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="c1"># calculate a &quot;typical&quot; treatment value, using the mean of the absolute value of non-zero treatments</span>
            <span class="n">treatment_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">T</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">_result</span><span class="p">(</span><span class="n">feature_index</span><span class="o">=</span><span class="n">feat_ind</span><span class="p">,</span>
                         <span class="n">feature_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">feature_baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span>
                         <span class="n">feature_levels</span><span class="o">=</span><span class="n">cats</span><span class="p">,</span>
                         <span class="n">hinds</span><span class="o">=</span><span class="n">hinds</span><span class="p">,</span>
                         <span class="n">X_transformer</span><span class="o">=</span><span class="n">X_transformer</span><span class="p">,</span>
                         <span class="n">W_transformer</span><span class="o">=</span><span class="n">W_transformer</span><span class="p">,</span>
                         <span class="n">estimator</span><span class="o">=</span><span class="n">est</span><span class="p">,</span>
                         <span class="n">global_inference</span><span class="o">=</span><span class="n">global_inference</span><span class="p">,</span>
                         <span class="n">treatment_value</span><span class="o">=</span><span class="n">treatment_value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">insights</span><span class="p">,</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception caught when training model for feature </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e</span>


<span class="c1"># Unless we&#39;re opting into minimal cross-fitting, this is the minimum number of instances of each category</span>
<span class="c1"># required to fit a discrete DML model</span>
<span class="n">_CAT_LIMIT</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># TODO: Add other nuisance model options, such as {&#39;azure_automl&#39;, &#39;forests&#39;, &#39;boosting&#39;} that will use particular</span>
<span class="c1">#       sub-cases of models or also integrate with azure autoML. (post-MVP)</span>
<span class="c1"># TODO: Add other heterogeneity model options, such as {&#39;automl&#39;} for performing</span>
<span class="c1">#       model selection for the causal effect, or {&#39;sparse_linear&#39;} for using a debiased lasso. (post-MVP)</span>
<span class="c1"># TODO: Enable multi-class classification (post-MVP)</span>


<div class="viewcode-block" id="CausalAnalysis">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CausalAnalysis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Note: this class is experimental and the API may evolve over our next few releases.</span>

<span class="sd">    Gets causal importance of features.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    feature_inds: array_like of int, str, or bool</span>
<span class="sd">        The features for which to estimate causal effects, expressed as either column indices,</span>
<span class="sd">        column names, or boolean flags indicating which columns to pick</span>
<span class="sd">    categorical: array_like of int, str, or bool</span>
<span class="sd">        The features which are categorical in nature, expressed as either column indices,</span>
<span class="sd">        column names, or boolean flags indicating which columns to pick</span>
<span class="sd">    heterogeneity_inds: array_like of int, str, or bool, or None or list of array_like elements or None, default None</span>
<span class="sd">        If a 1d array, then whenever estimating a heterogeneous (local) treatment effect</span>
<span class="sd">        model, then only the features in this array will be used for heterogeneity. If a 2d</span>
<span class="sd">        array then its first dimension should be len(feature_inds) and whenever estimating</span>
<span class="sd">        a local causal effect for target feature feature_inds[i], then only features in</span>
<span class="sd">        heterogeneity_inds[i] will be used for heterogeneity. If heterogeneity_inds[i]=None, then all features</span>
<span class="sd">        are used for heterogeneity when estimating local causal effect for feature_inds[i], and likewise if</span>
<span class="sd">        heterogeneity_inds[i]=[] then no features will be used for heterogeneity. If heterogeneity_ind=None</span>
<span class="sd">        then all features are used for heterogeneity for all features, and if heterogeneity_inds=[] then</span>
<span class="sd">        no features will be.</span>
<span class="sd">    feature_names: list of str, optional</span>
<span class="sd">        The names for all of the features in the data.  Not necessary if the input will be a dataframe.</span>
<span class="sd">        If None and the input is a plain numpy array, generated feature names will be [&#39;X1&#39;, &#39;X2&#39;, ...].</span>
<span class="sd">    upper_bound_on_cat_expansion: int, default 5</span>
<span class="sd">        The maximum number of categorical values allowed, because they are expanded via one-hot encoding. If a</span>
<span class="sd">        feature has more than this many values, then a causal effect model is not fitted for that target feature</span>
<span class="sd">        and a warning flag is raised. The remainder of the models are fitted.</span>
<span class="sd">    classification: bool, default False</span>
<span class="sd">        Whether this is a classification (as opposed to regression) task</span>
<span class="sd">    nuisance_models: one of {&#39;linear&#39;, &#39;automl&#39;}, default &#39;linear&#39;</span>
<span class="sd">        The model class to use for nuisance estimation.  Separate nuisance models are trained to predict the</span>
<span class="sd">        outcome and also each individual feature column from all of the other columns in the dataset as a prerequisite</span>
<span class="sd">        step before computing the actual causal effect for that feature column. If &#39;linear&#39;, then</span>
<span class="sd">        :class:`~sklearn.linear_model.LassoCV` (for regression) or :class:`~sklearn.linear_model.LogisticRegressionCV`</span>
<span class="sd">        (for classification) is used for these models. If &#39;automl&#39;, then model selection picks the best-performing</span>
<span class="sd">        among several different model classes for each model being trained using k-fold cross-validation, which</span>
<span class="sd">        requires additional computation.</span>
<span class="sd">    heterogeneity_model: one of {&#39;linear&#39;, &#39;forest&#39;}, default &#39;linear&#39;</span>
<span class="sd">        The type of model to use for the final heterogeneous treatment effect model. &#39;linear&#39; means that a</span>
<span class="sd">        the estimated treatment effect for a column will be a linear function of the heterogeneity features for that</span>
<span class="sd">        column, while &#39;forest&#39; means that a forest model will be trained to compute the effect from those heterogeneity</span>
<span class="sd">        features instead.</span>
<span class="sd">    categories: &#39;auto&#39; or list of (&#39;auto&#39; or list of values), default &#39;auto&#39;</span>
<span class="sd">        What categories to use for the categorical columns.  If &#39;auto&#39;, then the categories will be inferred for</span>
<span class="sd">        all categorical columns; otherwise this argument should have as many entries as there are categorical columns,</span>
<span class="sd">        and each entry should be either &#39;auto&#39; to infer the values for that column or the list of values for the</span>
<span class="sd">        column. If explicit values are provided, the first value is treated as the &quot;control&quot; value for that column</span>
<span class="sd">        against which other values are compared.</span>
<span class="sd">    n_jobs: int, default -1</span>
<span class="sd">        Degree of parallelism to use when training models via joblib.Parallel</span>
<span class="sd">    verbose : int, default 0</span>
<span class="sd">        Controls the verbosity when fitting and predicting.</span>
<span class="sd">    cv: int, cross-validation generator or an iterable, default 5</span>
<span class="sd">        Determines the strategy for cross-fitting used when training causal models for each feature.</span>
<span class="sd">        Possible inputs for cv are:</span>

<span class="sd">        - integer, to specify the number of folds.</span>
<span class="sd">        - :term:`CV splitter`</span>
<span class="sd">        - An iterable yielding (train, test) splits as arrays of indices.</span>

<span class="sd">        For integer inputs, if the treatment is discrete</span>
<span class="sd">        :class:`~sklearn.model_selection.StratifiedKFold` is used, else,</span>
<span class="sd">        :class:`~sklearn.model_selection.KFold` is used</span>
<span class="sd">        (with a random shuffle in either case).</span>
<span class="sd">    mc_iters: int, default 3</span>
<span class="sd">        The number of times to rerun the first stage models to reduce the variance of the causal model nuisances.</span>
<span class="sd">    skip_cat_limit_checks: bool, default False</span>
<span class="sd">        By default, categorical features need to have several instances of each category in order for a model to be</span>
<span class="sd">        fit robustly. Setting this to True will skip these checks (although at least 2 instances will always be</span>
<span class="sd">        required for linear heterogeneity models, and 4 for forest heterogeneity models even in that case).</span>
<span class="sd">    random_state : int, RandomState instance, or None, default None</span>
<span class="sd">        Controls the randomness of the estimator. The features are always</span>
<span class="sd">        randomly permuted at each split. When ``max_features &lt; n_features``, the algorithm will</span>
<span class="sd">        select ``max_features`` at random at each split before finding the best</span>
<span class="sd">        split among them. But the best found split may vary across different</span>
<span class="sd">        runs, even if ``max_features=n_features``. That is the case, if the</span>
<span class="sd">        improvement of the criterion is identical for several splits and one</span>
<span class="sd">        split has to be selected at random. To obtain a deterministic behaviour</span>
<span class="sd">        during fitting, ``random_state`` has to be fixed to an integer.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nuisance_models_: str</span>
<span class="sd">        The nuisance models setting used for the most recent call to fit</span>
<span class="sd">    heterogeneity_model: str</span>
<span class="sd">        The heterogeneity model setting used for the most recent call to fit</span>
<span class="sd">    feature_names_: list of str</span>
<span class="sd">        The list of feature names from the data in the most recent call to fit</span>
<span class="sd">    trained_feature_indices_: list of int</span>
<span class="sd">        The list of feature indices where models were trained successfully</span>
<span class="sd">    untrained_feature_indices_: list of tuple of (int, str or Exception)</span>
<span class="sd">        The list of indices that were requested but not able to be trained succesfully,</span>
<span class="sd">        along with either a reason or caught Exception for each</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CausalAnalysis.__init__">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_inds</span><span class="p">,</span> <span class="n">categorical</span><span class="p">,</span> <span class="n">heterogeneity_inds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">classification</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">upper_bound_on_cat_expansion</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nuisance_models</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">heterogeneity_model</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">categories</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mc_iters</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">skip_cat_limit_checks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_inds</span> <span class="o">=</span> <span class="n">feature_inds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span> <span class="o">=</span> <span class="n">categorical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_inds</span> <span class="o">=</span> <span class="n">heterogeneity_inds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">feature_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classification</span> <span class="o">=</span> <span class="n">classification</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound_on_cat_expansion</span> <span class="o">=</span> <span class="n">upper_bound_on_cat_expansion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span> <span class="o">=</span> <span class="n">nuisance_models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span> <span class="o">=</span> <span class="n">heterogeneity_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categories</span> <span class="o">=</span> <span class="n">categories</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="n">n_jobs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">cv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_iters</span> <span class="o">=</span> <span class="n">mc_iters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_cat_limit_checks</span> <span class="o">=</span> <span class="n">skip_cat_limit_checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span></div>


<div class="viewcode-block" id="CausalAnalysis.fit">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits global and local causal effect models for each feature in feature_inds on the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            Feature data</span>
<span class="sd">        y : array_like of shape (n,) or (n,1)</span>
<span class="sd">            Outcome. If classification=True, then y should take two values. Otherwise an error is raised</span>
<span class="sd">            that only binary classification is implemented for now.</span>
<span class="sd">            TODO. enable multi-class classification for y (post-MVP)</span>
<span class="sd">        warm_start : bool, default False</span>
<span class="sd">            If False, train models for each feature in `feature_inds`.</span>
<span class="sd">            If True, train only models for features in `feature_inds` that had not already been trained by</span>
<span class="sd">            the previous call to `fit`, and for which neither the corresponding heterogeneity_inds, nor the</span>
<span class="sd">            automl flag have changed. If heterogeneity_inds have changed, then the final stage model of these features</span>
<span class="sd">            will be refit. If the automl flag has changed, then whole model is refit, despite the warm start flag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate inputs</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;automl&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">],</span> <span class="p">(</span>
            <span class="s2">&quot;The only supported nuisance models are &#39;linear&#39; and &#39;automl&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;but was given </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;forest&#39;</span><span class="p">],</span> <span class="p">(</span>
            <span class="s2">&quot;The only supported heterogeneity models are &#39;linear&#39; and &#39;forest&#39; but received &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;X must be a 2-dimensional array, but here had shape </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">assert</span> <span class="n">iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_inds</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;feature_inds should be array_like, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_inds</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="n">iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;categorical should be array_like, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_inds</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_inds</span><span class="p">),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;heterogeneity_inds should be None or array_like, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_inds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;feature_names should be None or array_like, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span> <span class="ow">or</span> <span class="n">iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">),</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;categories should be &#39;auto&#39; or array_like, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># TODO: check compatibility of X and Y lengths</span>

        <span class="k">if</span> <span class="n">warm_start</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_results&quot;</span><span class="p">):</span>
                <span class="c1"># no previous fit, cancel warm start</span>
                <span class="n">warm_start</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span> <span class="o">!=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Can&#39;t warm start: previous X had </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span><span class="si">}</span><span class="s2"> columns, new X has </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> columns&quot;</span><span class="p">)</span>

        <span class="c1"># work with numeric feature indices, so that we can easily compare with categorical ones</span>
        <span class="n">train_inds</span> <span class="o">=</span> <span class="n">_get_column_indices</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_inds</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No features specified. At least one feature index must be specified so that a model can be trained.&quot;</span><span class="p">)</span>

        <span class="n">heterogeneity_inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_inds</span>
        <span class="k">if</span> <span class="n">heterogeneity_inds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">heterogeneity_inds</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">train_inds</span><span class="p">]</span>

        <span class="c1"># if heterogeneity_inds is 1D, repeat it</span>
        <span class="k">if</span> <span class="n">heterogeneity_inds</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">heterogeneity_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
            <span class="n">heterogeneity_inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">heterogeneity_inds</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">train_inds</span><span class="p">]</span>

        <span class="c1"># heterogeneity inds should be a 2D list of length same as train_inds</span>
        <span class="k">elif</span> <span class="n">heterogeneity_inds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">heterogeneity_inds</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_inds</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Heterogeneity indexes should have the same number of entries, but here &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot; there were </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">heterogeneity_inds</span><span class="p">)</span><span class="si">}</span><span class="s2"> heterogeneity entries but &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_inds</span><span class="p">)</span><span class="si">}</span><span class="s2"> feature indices.&quot;</span><span class="p">)</span>

        <span class="c1"># replace None elements of heterogeneity_inds and ensure indices are numeric</span>
        <span class="n">heterogeneity_inds</span> <span class="o">=</span> <span class="p">{</span><span class="n">ind</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">if</span> <span class="n">hinds</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_get_column_indices</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">hinds</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">hinds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">train_inds</span><span class="p">,</span> <span class="n">heterogeneity_inds</span><span class="p">)}</span>

        <span class="k">if</span> <span class="n">warm_start</span><span class="p">:</span>
            <span class="n">train_y_model</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models_</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;warm_start will be ignored since the nuisance models have changed &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models_</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span><span class="si">}</span><span class="s2"> since the previous call to fit&quot;</span><span class="p">)</span>
                <span class="n">warm_start</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">train_y_model</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model_</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;warm_start will be ignored since the heterogeneity model has changed &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model_</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span><span class="si">}</span><span class="s2"> &quot;</span>
                              <span class="s2">&quot;since the previous call to fit&quot;</span><span class="p">)</span>
                <span class="n">warm_start</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># TODO: bail out also if categorical columns, classification, random_state changed?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">train_y_model</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># TODO: should we also train a new model_y under any circumstances when warm_start is True?</span>
        <span class="k">if</span> <span class="n">warm_start</span><span class="p">:</span>
            <span class="n">new_inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">train_inds</span> <span class="k">if</span> <span class="p">(</span><span class="n">ind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="ow">or</span>
                                                      <span class="n">heterogeneity_inds</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hinds</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">train_inds</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># store mapping from feature to insights, results</span>

            <span class="c1"># train the Y model</span>
            <span class="k">if</span> <span class="n">train_y_model</span><span class="p">:</span>
                <span class="c1"># perform model selection for the Y model using all X, not on a per-column basis</span>
                <span class="n">allX</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([(</span><span class="s1">&#39;encode&#39;</span><span class="p">,</span>
                                           <span class="n">one_hot_encoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">)],</span>
                                         <span class="n">remainder</span><span class="o">=</span><span class="n">StandardScaler</span><span class="p">())</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CausalAnalysis: performing model selection on overall Y model&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_model_y</span> <span class="o">=</span> <span class="n">_first_stage_clf</span><span class="p">(</span><span class="n">allX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">automl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span> <span class="o">==</span> <span class="s1">&#39;automl&#39;</span><span class="p">,</span>
                                                     <span class="n">make_regressor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                     <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_model_y</span> <span class="o">=</span> <span class="n">_first_stage_reg</span><span class="p">(</span><span class="n">allX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">automl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span> <span class="o">==</span> <span class="s1">&#39;automl&#39;</span><span class="p">,</span>
                                                     <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification</span><span class="p">:</span>
            <span class="c1"># now that we&#39;ve trained the classifier and wrapped it, ensure that y is transformed to</span>
            <span class="c1"># work with the regression wrapper</span>

            <span class="c1"># we use column_or_1d to treat pd.Series and pd.DataFrame objects the same way as arrays</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">column_or_1d</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># note that this needs to happen after wrapping to generalize to the multi-class case,</span>
            <span class="c1"># since otherwise we&#39;ll have too many columns to be able to train a classifier</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Multiclass classification isn&#39;t supported&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification</span>
                                                <span class="k">else</span> <span class="s2">&quot;Only a single outcome is supported&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vec_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># start with empty results and default shared insights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span> <span class="o">=</span> <span class="n">_get_default_shared_insights_output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span><span class="p">[</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">InitArgsKey</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;feature_inds&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_inds</span><span class="p">),</span>
            <span class="s1">&#39;categorical&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">),</span>
            <span class="s1">&#39;heterogeneity_inds&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_inds</span><span class="p">),</span>
            <span class="s1">&#39;feature_names&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span><span class="p">),</span>
            <span class="s1">&#39;classification&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classification</span><span class="p">),</span>
            <span class="s1">&#39;upper_bound_on_cat_expansion&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upper_bound_on_cat_expansion</span><span class="p">),</span>
            <span class="s1">&#39;nuisance_models&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span><span class="p">),</span>
            <span class="s1">&#39;heterogeneity_model&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span><span class="p">),</span>
            <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">),</span>
            <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="p">),</span>
            <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">),</span>
            <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># convert categorical indicators to numeric indices</span>
        <span class="n">categorical_inds</span> <span class="o">=</span> <span class="n">_get_column_indices</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorical</span><span class="p">)</span>

        <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span>
        <span class="k">if</span> <span class="n">categories</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;auto&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">categorical_inds</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_inds</span><span class="p">),</span> <span class="p">(</span>
                <span class="s2">&quot;If categories is not &#39;auto&#39;, it must contain one entry per categorical column.  Instead, categories&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span><span class="si">}</span><span class="s2"> while there are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">categorical_inds</span><span class="p">)</span><span class="si">}</span><span class="s2"> categorical columns.&quot;</span><span class="p">)</span>

        <span class="c1"># check for indices over the categorical expansion bound</span>
        <span class="n">invalid_inds</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;untrained_feature_indices_&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># assume we&#39;ll be able to train former failures this time; we&#39;ll add them back if not</span>
        <span class="n">invalid_inds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ind</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span> <span class="ow">in</span> <span class="n">invalid_inds</span> <span class="k">if</span> <span class="n">ind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_inds</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_has_column_names</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;iloc&quot;</span><span class="p">):</span>
                <span class="n">feature_names</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_has_column_names</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_names_</span> <span class="o">=</span> <span class="n">feature_names</span>

        <span class="n">min_counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">new_inds</span><span class="p">:</span>
            <span class="n">column_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_col</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">categorical_inds</span><span class="p">:</span>
                <span class="n">cats</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_safe_indexing</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">min_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
                <span class="n">n_cat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n_cat</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound_on_cat_expansion</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_text</span><span class="si">}</span><span class="s2"> has more than </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">upper_bound_on_cat_expansion</span><span class="si">}</span><span class="s2"> &quot;</span>
                                  <span class="sa">f</span><span class="s2">&quot;values (found </span><span class="si">{</span><span class="n">n_cat</span><span class="si">}</span><span class="s2">) so no heterogeneity model will be fit for it; &quot;</span>
                                  <span class="s2">&quot;increase &#39;upper_bound_on_cat_expansion&#39; to change this behavior.&quot;</span><span class="p">)</span>
                    <span class="c1"># can&#39;t remove in place while iterating over new_inds, so store in separate list</span>
                    <span class="n">invalid_inds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;upper_bound_on_cat_expansion&#39;</span><span class="p">))</span>

                <span class="k">elif</span> <span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">_CAT_LIMIT</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_cat_limit_checks</span> <span class="ow">and</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">or</span>
                                                       <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span> <span class="o">!=</span> <span class="s1">&#39;forest&#39;</span><span class="p">)):</span>
                        <span class="c1"># train the model, but warn</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_text</span><span class="si">}</span><span class="s2">&#39;s value </span><span class="si">{</span><span class="n">cats</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span><span class="si">}</span><span class="s2"> has only </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span><span class="si">}</span><span class="s2"> instances in &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;the training dataset, which is less than the lower limit (</span><span class="si">{</span><span class="n">_CAT_LIMIT</span><span class="si">}</span><span class="s2">). &quot;</span>
                                      <span class="s2">&quot;A model will still be fit because &#39;skip_cat_limit_checks&#39; is True, &quot;</span>
                                      <span class="s2">&quot;but this model may not be robust.&quot;</span><span class="p">)</span>
                        <span class="n">min_counts</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span> <span class="o">==</span> <span class="s1">&#39;forest&#39;</span><span class="p">):</span>
                        <span class="c1"># no model can be trained in this case since we need more folds</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_text</span><span class="si">}</span><span class="s2">&#39;s value </span><span class="si">{</span><span class="n">cats</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span><span class="si">}</span><span class="s2"> has only </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span><span class="si">}</span><span class="s2"> instances in &quot;</span>
                                      <span class="s2">&quot;the training dataset, but linear heterogeneity models need at least 2 and &quot;</span>
                                      <span class="s2">&quot;forest heterogeneity models need at least 5 instances, so no model will be fit &quot;</span>
                                      <span class="s2">&quot;for this column&quot;</span><span class="p">)</span>
                        <span class="n">invalid_inds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;cat_limit&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># don&#39;t train a model, but suggest workaround since there are enough instances of least</span>
                        <span class="c1"># populated class</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_text</span><span class="si">}</span><span class="s2">&#39;s value </span><span class="si">{</span><span class="n">cats</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span><span class="si">}</span><span class="s2"> has only </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">min_ind</span><span class="p">]</span><span class="si">}</span><span class="s2"> instances in &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;the training dataset, which is less than the lower limit (</span><span class="si">{</span><span class="n">_CAT_LIMIT</span><span class="si">}</span><span class="s2">), &quot;</span>
                                      <span class="s2">&quot;so no heterogeneity model will be fit for it. This check can be turned off by &quot;</span>
                                      <span class="s2">&quot;setting &#39;skip_cat_limit_checks&#39; to True, but that may result in an inaccurate &quot;</span>
                                      <span class="s2">&quot;model for this feature.&quot;</span><span class="p">)</span>
                        <span class="n">invalid_inds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ind</span><span class="p">,</span> <span class="s1">&#39;cat_limit&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">invalid_inds</span><span class="p">:</span>
            <span class="n">new_inds</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="c1"># also remove from train_inds so we don&#39;t try to access the result later</span>
            <span class="n">train_inds</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_inds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No features remain; increase the upper_bound_on_cat_expansion and ensure that there &quot;</span>
                                 <span class="s2">&quot;are several instances of each categorical value so that at least &quot;</span>
                                 <span class="s2">&quot;one feature model can be trained.&quot;</span><span class="p">)</span>

        <span class="c1"># extract subset of names matching new columns</span>
        <span class="n">new_feat_names</span> <span class="o">=</span> <span class="n">_safe_indexing</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">new_inds</span><span class="p">)</span>

        <span class="n">cache_updates</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">new_inds</span><span class="p">,</span>
                                 <span class="n">joblib</span><span class="o">.</span><span class="n">Parallel</span><span class="p">(</span>
                                     <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="p">,</span>
                                     <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
                                 <span class="p">)(</span><span class="n">joblib</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">_process_feature</span><span class="p">)(</span>
                                     <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_ind</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="n">categorical_inds</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span> <span class="n">heterogeneity_inds</span><span class="p">,</span> <span class="n">min_counts</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_y</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_iters</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">feat_ind</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_feat_names</span><span class="p">,</span> <span class="n">new_inds</span><span class="p">))))</span>

        <span class="c1"># track indices where an exception was thrown, since we can&#39;t remove from dictionary while iterating</span>
        <span class="n">inds_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cache_updates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
                <span class="c1"># don&#39;t want to cache this failed result</span>
                <span class="n">inds_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                <span class="n">train_inds</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                <span class="n">invalid_inds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ind</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">inds_to_remove</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">cache_updates</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cache_updates</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">train_inds</span><span class="p">:</span>
            <span class="n">dict_update</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict_update</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dict_update</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">invalid_inds</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">untrained_feature_indices_</span> <span class="o">=</span> <span class="n">invalid_inds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trained_feature_indices_</span> <span class="o">=</span> <span class="n">train_inds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuisance_models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heterogeneity_model</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_format_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_column_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">ind</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">ind</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># properties to return from effect InferenceResults</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_point_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PointEstimateKey</span><span class="p">,</span> <span class="s1">&#39;point_estimate&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">StandardErrorKey</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ZStatKey</span><span class="p">,</span> <span class="s1">&#39;zstat&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PValueKey</span><span class="p">,</span> <span class="s1">&#39;pvalue&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalLowerKey</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">inf</span><span class="p">:</span> <span class="n">inf</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalUpperKey</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">inf</span><span class="p">:</span> <span class="n">inf</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="c1"># properties to return from PopulationSummaryResults</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_summary_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PointEstimateKey</span><span class="p">,</span> <span class="s1">&#39;mean_point&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">StandardErrorKey</span><span class="p">,</span> <span class="s1">&#39;stderr_mean&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ZStatKey</span><span class="p">,</span> <span class="s1">&#39;zstat&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">PValueKey</span><span class="p">,</span> <span class="s1">&#39;pvalue&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalLowerKey</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">inf</span><span class="p">:</span> <span class="n">inf</span><span class="o">.</span><span class="n">conf_int_mean</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">ConfidenceIntervalUpperKey</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">inf</span><span class="p">:</span> <span class="n">inf</span><span class="o">.</span><span class="n">conf_int_mean</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>

    <span class="c1"># Converts strings to property lookups or method calls as a convenience so that the</span>
    <span class="c1"># _point_props and _summary_props above can be applied to an inference object</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_make_accessor</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">attr</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">attr</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">val</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">attr</span>

    <span class="c1"># Create a summary combining all results into a single output; this is used</span>
    <span class="c1"># by the various causal_effect and causal_effect_dict methods to generate either a dataframe</span>
    <span class="c1"># or a dictionary, respectively, based on the summary function passed into this method</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">get_inference</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">expand_arr</span><span class="p">,</span> <span class="n">drop_sample</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_results&quot;</span><span class="p">),</span> <span class="s2">&quot;This object has not been fit, so cannot get results&quot;</span>

        <span class="c1"># ensure array has shape (m,y,t)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">ensure_proper_dims</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">expand_arr</span><span class="p">:</span>
                <span class="c1"># population summary is missing sample dimension; add it for consistency</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vec_y</span><span class="p">:</span>
                <span class="c1"># outcome dimension is missing; add it for consistency</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">assert</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
            <span class="c1"># add singleton treatment dimension if missing</span>
            <span class="k">return</span> <span class="n">arr</span> <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># store set of inference results so we don&#39;t need to recompute per-attribute below in summary/coalesce</span>
        <span class="n">infs</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_inference</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">]</span>

        <span class="c1"># each attr has dimension (m,y) or (m,y,t)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">coalesce</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Join together the arrays for each feature.&quot;&quot;&quot;</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_accessor</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            <span class="c1"># concatenate along treatment dimension</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ensure_proper_dims</span><span class="p">(</span><span class="n">attr</span><span class="p">(</span><span class="n">inf</span><span class="p">))</span>
                                  <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="n">infs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># for dictionary representation, want to remove unneeded sample dimension</span>
            <span class="c1"># in cohort and global results</span>
            <span class="k">if</span> <span class="n">drop_sample</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">arr</span>

        <span class="k">return</span> <span class="n">summary</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="n">coalesce</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">props</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pandas_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_inference</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span>
                        <span class="n">expand_arr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_all_levels</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarizes results into a dataframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        get_inference : lambda</span>
<span class="sd">            Method to get the relevant inference results from each result object</span>
<span class="sd">        props : list of (string, str or lambda)</span>
<span class="sd">            Set of column names and ways to get the corresponding values from the inference object</span>
<span class="sd">        n : int</span>
<span class="sd">            The number of samples in the dataset</span>
<span class="sd">        expand_arr : bool, default False</span>
<span class="sd">            Whether to add a synthetic sample dimension to the result arrays when performing internal computations</span>
<span class="sd">        keep_all_levels : bool, default False</span>
<span class="sd">            Whether to keep all levels, even when they don&#39;t take on more than one value;</span>
<span class="sd">            Note that regardless of this argument the &quot;sample&quot; level will only be present if expand_arr is False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">make_dataframe</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>

            <span class="n">to_include</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                                      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">props</span><span class="p">])</span>

            <span class="c1"># TODO: enrich outcome logic for multi-class classification when that is supported</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">feature_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lvl</span><span class="si">}</span><span class="s2">v</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">feature_baseline</span><span class="si">}</span><span class="s2">&quot;</span>
                                                <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">feature_baseline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                                <span class="k">else</span> <span class="n">lvl</span><span class="p">)</span>
                                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                               <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">]</span>
                                               <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
                                               <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">feature_levels</span><span class="p">],</span>
                                              <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;outcome&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_value&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">expand_arr</span><span class="p">:</span>
                <span class="c1"># There is no actual sample level in this data</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_all_levels</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lvl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                            <span class="c1"># can&#39;t drop only level</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">feature_name</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">lvl</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">to_include</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summarize</span><span class="p">(</span><span class="n">summary</span><span class="o">=</span><span class="n">make_dataframe</span><span class="p">,</span>
                               <span class="n">get_inference</span><span class="o">=</span><span class="n">get_inference</span><span class="p">,</span>
                               <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
                               <span class="n">expand_arr</span><span class="o">=</span><span class="n">expand_arr</span><span class="p">,</span>
                               <span class="n">drop_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># dropping the sample dimension is handled above instead</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_dict_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_inference</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">drop_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">expand_arr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarizes results into a dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        get_inference : lambda</span>
<span class="sd">            Method to get the relevant inference results from each result object</span>
<span class="sd">        n : int</span>
<span class="sd">            The number of samples in the dataset</span>
<span class="sd">        props : list of (string, str or lambda)</span>
<span class="sd">            Set of column names and ways to get the corresponding values from the inference object</span>
<span class="sd">        kind : str</span>
<span class="sd">            The kind of inference results to get (e.g. &#39;global&#39;, &#39;local&#39;, or &#39;cohort&#39;)</span>
<span class="sd">        drop_sample : bool, default False</span>
<span class="sd">            Whether to drop the sample dimension from each array</span>
<span class="sd">        expand_arr : bool, default False</span>
<span class="sd">            Whether to add an initial sample dimension to the result arrays</span>
<span class="sd">        row_wise : bool, default False</span>
<span class="sd">            Whether to return a list of dictionaries (one dictionary per row) instead of</span>
<span class="sd">            a dictionary of lists (one list per column)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">make_dict</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
            <span class="c1"># should be serialization-ready and contain no numpy arrays</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_get_default_specific_insights</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>
            <span class="n">shared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared</span>

            <span class="k">if</span> <span class="n">row_wise</span><span class="p">:</span>
                <span class="n">row_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="c1"># remove entries belonging to row data, since we&#39;re including them in the list of nested dictionaries</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_get_data_causal_insights_keys</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="n">shared</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy so that we can modify without affecting shared state</span>
                <span class="c1"># TODO: Note that there&#39;s no column metadata for the sample number - should there be?</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_get_column_causal_insights_keys</span><span class="p">():</span>
                    <span class="c1"># need to replicate the column info for each sample, then remove from the shared data</span>
                    <span class="n">row_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shared</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
                    <span class="k">del</span> <span class="n">shared</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="c1"># NOTE: the flattened order has the ouptut dimension before the feature dimension</span>
                <span class="c1">#       which may need to be revisited once we support multiclass</span>
                <span class="n">row_data</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">props</span><span class="p">])</span>

                <span class="c1"># get the length of the list corresponding to the first dictionary key</span>
                <span class="c1"># `list(row_data)` gets the keys as a list, since `row_data.keys()` can&#39;t be indexed into</span>
                <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">row_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">res</span><span class="p">[</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">RowData</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="n">key</span><span class="p">:</span> <span class="n">row_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                                                          <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">props</span><span class="p">])</span>

            <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">shared</span><span class="p">,</span> <span class="o">**</span><span class="n">res</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summarize</span><span class="p">(</span><span class="n">summary</span><span class="o">=</span><span class="n">make_dict</span><span class="p">,</span>
                               <span class="n">get_inference</span><span class="o">=</span><span class="n">get_inference</span><span class="p">,</span>
                               <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
                               <span class="n">expand_arr</span><span class="o">=</span><span class="n">expand_arr</span><span class="p">,</span>
                               <span class="n">drop_sample</span><span class="o">=</span><span class="n">drop_sample</span><span class="p">)</span>

<div class="viewcode-block" id="CausalAnalysis.global_causal_effect">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.global_causal_effect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">global_causal_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">keep_all_levels</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the global causal effect for each feature as a pandas DataFrame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : float, default 0.05</span>
<span class="sd">            The confidence level of the confidence interval</span>
<span class="sd">        keep_all_levels : bool, default False</span>
<span class="sd">            Whether to keep all levels of the output dataframe (&#39;outcome&#39;, &#39;feature&#39;, and &#39;feature_level&#39;)</span>
<span class="sd">            even if there was only a single value for that level; by default single-valued levels are dropped.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        global_effects : DataFrame</span>
<span class="sd">            DataFrame with the following structure:</span>

<span class="sd">            :Columns: [&#39;point&#39;, &#39;stderr&#39;, &#39;zstat&#39;, &#39;pvalue&#39;, &#39;ci_lower&#39;, &#39;ci_upper&#39;]</span>
<span class="sd">            :Index: [&#39;feature&#39;, &#39;feature_value&#39;]</span>
<span class="sd">            :Rows: For each feature that is numerical, we have an entry with index [&#39;{feature_name}&#39;, &#39;num&#39;], where</span>
<span class="sd">                    &#39;num&#39; is literally the string &#39;num&#39; and feature_name is the input feature name.</span>
<span class="sd">                    For each feature that is categorical, we have an entry with index [&#39;{feature_name}&#39;,</span>
<span class="sd">                    &#39;{cat}v{base}&#39;] where cat is the category value and base is the category used as baseline.</span>
<span class="sd">                    If all features are numerical then the feature_value index is dropped in the dataframe, but not</span>
<span class="sd">                    in the serialized dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># a global inference indicates the effect of that one feature on the outcome</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pandas_summary</span><span class="p">(</span><span class="k">lambda</span> <span class="n">res</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">global_inference</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
                                    <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">expand_arr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_all_levels</span><span class="o">=</span><span class="n">keep_all_levels</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_global_causal_effect_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the global causal effect for each feature as dictionary.</span>

<span class="sd">        Dictionary entries for predictions, etc. will be nested lists of shape (d_y, sum(d_t))</span>

<span class="sd">        Only for serialization purposes to upload to AzureML</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_summary</span><span class="p">(</span><span class="k">lambda</span> <span class="n">res</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">global_inference</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
                                  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="n">row_wise</span><span class="p">,</span> <span class="n">drop_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expand_arr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cohort_effect_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Shape of Xtest must be compatible with shape of X, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;but got shape </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead of (n, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">inference_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">est</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">estimator</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">X_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">est</span><span class="o">.</span><span class="n">const_marginal_ate_inference</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inference_from_result</span>

<div class="viewcode-block" id="CausalAnalysis.cohort_causal_effect">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.cohort_causal_effect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cohort_causal_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">keep_all_levels</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the average causal effects for a particular cohort defined by a population of X&#39;s.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Xtest : array_like</span>
<span class="sd">            The cohort samples for which to return the average causal effects within cohort</span>
<span class="sd">        alpha : float, default 0.05</span>
<span class="sd">            The confidence level of the confidence interval</span>
<span class="sd">        keep_all_levels : bool, default False</span>
<span class="sd">            Whether to keep all levels of the output dataframe (&#39;outcome&#39;, &#39;feature&#39;, and &#39;feature_level&#39;)</span>
<span class="sd">            even if there was only a single value for that level; by default single-valued levels are dropped.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cohort_effects : DataFrame</span>
<span class="sd">            DataFrame with the following structure:</span>

<span class="sd">            :Columns: [&#39;point&#39;, &#39;stderr&#39;, &#39;zstat&#39;, &#39;pvalue&#39;, &#39;ci_lower&#39;, &#39;ci_upper&#39;]</span>
<span class="sd">            :Index: [&#39;feature&#39;, &#39;feature_value&#39;]</span>
<span class="sd">            :Rows: For each feature that is numerical, we have an entry with index [&#39;{feature_name}&#39;, &#39;num&#39;], where</span>
<span class="sd">              &#39;num&#39; is literally the string &#39;num&#39; and feature_name is the input feature name.</span>
<span class="sd">              For each feature that is categorical, we have an entry with index [&#39;{feature_name}&#39;, &#39;{cat}v{base}&#39;]</span>
<span class="sd">              where cat is the category value and base is the category used as baseline.</span>
<span class="sd">              If all features are numerical then the feature_value index is dropped in the dataframe, but not</span>
<span class="sd">              in the serialized dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pandas_summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cohort_effect_inference</span><span class="p">(</span><span class="n">Xtest</span><span class="p">),</span>
                                    <span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_summary_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">expand_arr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_all_levels</span><span class="o">=</span><span class="n">keep_all_levels</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_cohort_causal_effect_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the cohort causal effects for each feature as dictionary.</span>

<span class="sd">        Dictionary entries for predictions, etc. will be nested lists of shape (d_y, sum(d_t))</span>

<span class="sd">        Only for serialization purposes to upload to AzureML</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cohort_effect_inference</span><span class="p">(</span><span class="n">Xtest</span><span class="p">),</span> <span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_summary_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
                                  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cohort&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="n">row_wise</span><span class="p">,</span> <span class="n">expand_arr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop_sample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_local_effect_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Shape of Xtest must be compatible with shape of X, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;but got shape </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead of (n, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">inference_from_result</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">est</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">estimator</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">X_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">eff</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">const_marginal_effect_inference</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># need to reshape the output to match the input</span>
                <span class="n">eff</span> <span class="o">=</span> <span class="n">eff</span><span class="o">.</span><span class="n">_expand_outputs</span><span class="p">(</span><span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">eff</span>
        <span class="k">return</span> <span class="n">inference_from_result</span>

<div class="viewcode-block" id="CausalAnalysis.local_causal_effect">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.local_causal_effect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">local_causal_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">keep_all_levels</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the local causal effect for each feature as a pandas DataFrame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Xtest : array_like</span>
<span class="sd">            The samples for which to return the causal effects</span>
<span class="sd">        alpha : float, default 0.05</span>
<span class="sd">            The confidence level of the confidence interval</span>
<span class="sd">        keep_all_levels : bool, default False</span>
<span class="sd">            Whether to keep all levels of the output dataframe (&#39;sample&#39;, &#39;outcome&#39;, &#39;feature&#39;, and &#39;feature_level&#39;)</span>
<span class="sd">            even if there was only a single value for that level; by default single-valued levels are dropped.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        global_effect : DataFrame</span>
<span class="sd">            DataFrame with the following structure:</span>

<span class="sd">            :Columns: [&#39;point&#39;, &#39;stderr&#39;, &#39;zstat&#39;, &#39;pvalue&#39;, &#39;ci_lower&#39;, &#39;ci_upper&#39;]</span>
<span class="sd">            :Index: [&#39;sample&#39;, &#39;feature&#39;, &#39;feature_value&#39;]</span>
<span class="sd">            :Rows: For each feature that is numeric, we have an entry with index</span>
<span class="sd">                   [&#39;{sampleid}&#39;, &#39;{feature_name}&#39;, &#39;num&#39;],</span>
<span class="sd">                   where &#39;num&#39; is literally the string &#39;num&#39; and feature_name is the input feature name and sampleid is</span>
<span class="sd">                   the index of the sample in Xtest.</span>
<span class="sd">                   For each feature that is categorical, we have an entry with index</span>
<span class="sd">                   [&#39;{sampleid&#39;, &#39;{feature_name}&#39;, &#39;{cat}v{base}&#39;]</span>
<span class="sd">                   where cat is the category value and base is the category used as baseline.</span>
<span class="sd">                   If all features are numerical then the feature_value index is dropped in the dataframe, but not</span>
<span class="sd">                   in the serialized dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pandas_summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_effect_inference</span><span class="p">(</span><span class="n">Xtest</span><span class="p">),</span>
                                    <span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keep_all_levels</span><span class="o">=</span><span class="n">keep_all_levels</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_local_causal_effect_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the local feature importance as dictionary.</span>

<span class="sd">        Dictionary entries for predictions, etc. will be nested lists of shape (n_rows, d_y, sum(d_t))</span>

<span class="sd">        Only for serialization purposes to upload to AzureML</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_effect_inference</span><span class="p">(</span><span class="n">Xtest</span><span class="p">),</span> <span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_point_props</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
                                  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;local&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row_wise</span><span class="o">=</span><span class="n">row_wise</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_safe_result_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_results&quot;</span><span class="p">),</span> <span class="s2">&quot;This instance has not yet been fitted&quot;</span>

        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Shape of X must be compatible with shape of the fitted X, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;but got shape </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead of (n, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_d_x</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="p">(</span><span class="n">numeric_index</span><span class="p">,)</span> <span class="o">=</span> <span class="n">_get_column_indices</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">feature_index</span><span class="p">])</span>

        <span class="n">bad_inds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">untrained_feature_indices_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numeric_index</span> <span class="ow">in</span> <span class="n">bad_inds</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">bad_inds</span><span class="p">[</span><span class="n">numeric_index</span><span class="p">]</span>
            <span class="n">col_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_col</span><span class="p">(</span><span class="n">numeric_index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;cat_limit&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col_text</span><span class="si">}</span><span class="s2"> had a value with fewer than </span><span class="si">{</span><span class="n">_CAT_LIMIT</span><span class="si">}</span><span class="s2"> occurences, so no model was fit for it&quot;</span>
            <span class="k">elif</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;upper_bound_on_cat_expansion&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col_text</span><span class="si">}</span><span class="s2"> had more distinct values than the setting of &#39;upper_bound_on_cat_expansion&#39;, &quot;</span>
                       <span class="s2">&quot;so no model was fit for it&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col_text</span><span class="si">}</span><span class="s2"> generated the following error during fitting, &quot;</span>
                       <span class="sa">f</span><span class="s2">&quot;so no model was fit for it:</span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">numeric_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained_feature_indices_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_col</span><span class="p">(</span><span class="n">numeric_index</span><span class="p">)</span><span class="si">}</span><span class="s2"> was not passed as a feature index &quot;</span>
                             <span class="s2">&quot;so no model was fit for it&quot;</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
                   <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">feature_index</span> <span class="o">==</span> <span class="n">numeric_index</span><span class="p">]</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">(</span><span class="n">result</span><span class="p">,)</span> <span class="o">=</span> <span class="n">results</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_whatif_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification</span><span class="p">,</span> <span class="s2">&quot;What-if analysis cannot be applied to classification tasks&quot;</span>

        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span>
            <span class="s2">&quot;X, Xnew, and y must have the same length, but have shapes &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Xnew</span><span class="p">)</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">feature_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Only one feature index may be changed, but got </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">feature_index</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">T0</span> <span class="o">=</span> <span class="n">_safe_indexing</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">T1</span> <span class="o">=</span> <span class="n">Xnew</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_result_index</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">X_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">inf</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">effect_inference</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">T0</span><span class="p">,</span> <span class="n">T1</span><span class="o">=</span><span class="n">T1</span><span class="p">)</span>

        <span class="c1"># we want to offset the inference object by the baseline estimate of y</span>
        <span class="n">inf</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inf</span>

<div class="viewcode-block" id="CausalAnalysis.whatif">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.whatif">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">whatif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get counterfactual predictions when feature_index is changed to Xnew from its observational counterpart.</span>

<span class="sd">        Note that this only applies to regression use cases; for classification what-if analysis is not supported.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X: array_like</span>
<span class="sd">            Features</span>
<span class="sd">        Xnew: array_like</span>
<span class="sd">            New values of a single column of X</span>
<span class="sd">        feature_index: int or str</span>
<span class="sd">            The index of the feature being varied to Xnew, either as a numeric index or</span>
<span class="sd">            the string name if the input is a dataframe</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Observed labels or outcome of a predictive model for baseline y values</span>
<span class="sd">        alpha : float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals displayed in the leaf nodes.</span>
<span class="sd">            A (1-alpha)*100% confidence interval is displayed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        y_new: DataFrame</span>
<span class="sd">            The predicted outputs that would have been observed under the counterfactual features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whatif_inference</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_whatif_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">row_wise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get counterfactual predictions when feature_index is changed to Xnew from its observational counterpart.</span>

<span class="sd">        Note that this only applies to regression use cases; for classification what-if analysis is not supported.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X: array_like</span>
<span class="sd">            Features</span>
<span class="sd">        Xnew: array_like</span>
<span class="sd">            New values of a single column of X</span>
<span class="sd">        feature_index: int or str</span>
<span class="sd">            The index of the feature being varied to Xnew, either as a numeric index or</span>
<span class="sd">            the string name if the input is a dataframe</span>
<span class="sd">        y: array_like</span>
<span class="sd">            Observed labels or outcome of a predictive model for baseline y values</span>
<span class="sd">        alpha : float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals displayed in the leaf nodes.</span>
<span class="sd">            A (1-alpha)*100% confidence interval is displayed.</span>
<span class="sd">        row_wise : bool, default False</span>
<span class="sd">            Whether to return a list of dictionaries (one dictionary per row) instead of</span>
<span class="sd">            a dictionary of lists (one list per column)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict : dict</span>
<span class="sd">            The counterfactual predictions, as a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whatif_inference</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Xnew</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_point_props</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_get_default_specific_insights</span><span class="p">(</span><span class="s1">&#39;whatif&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">row_wise</span><span class="p">:</span>
            <span class="n">row_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># remove entries belonging to row data, since we&#39;re including them in the list of nested dictionaries</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_get_data_causal_insights_keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">row_data</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_accessor</span><span class="p">(</span><span class="n">attr</span><span class="p">)(</span><span class="n">inf</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">props</span><span class="p">])</span>

            <span class="c1"># get the length of the list corresponding to the first dictionary key</span>
            <span class="c1"># `list(row_data)` gets the keys as a list, since `row_data.keys()` can&#39;t be indexed into</span>
            <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">row_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">res</span><span class="p">[</span><span class="n">_CausalInsightsConstants</span><span class="o">.</span><span class="n">RowData</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="n">key</span><span class="p">:</span> <span class="n">row_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                                                      <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_accessor</span><span class="p">(</span><span class="n">attr</span><span class="p">)(</span><span class="n">inf</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">props</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_policy</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">treatment_costs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
              <span class="n">include_model_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_result_index</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">)</span>
        <span class="n">Xtest</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">X_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Xtest</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">feature_baseline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">treatment_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;decrease&#39;</span><span class="p">,</span> <span class="s1">&#39;increase&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">treatment_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">feature_baseline</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">+</span> \
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lvl</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">feature_levels</span><span class="p">]</span>

        <span class="n">TreeType</span> <span class="o">=</span> <span class="n">SingleTreePolicyInterpreter</span> <span class="k">if</span> <span class="n">is_policy</span> <span class="k">else</span> <span class="n">SingleTreeCateInterpreter</span>
        <span class="n">intrp</span> <span class="o">=</span> <span class="n">TreeType</span><span class="p">(</span><span class="n">include_model_uncertainty</span><span class="o">=</span><span class="n">include_model_uncertainty</span><span class="p">,</span>
                         <span class="n">uncertainty_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                         <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                         <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                         <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">min_impurity_decrease</span><span class="p">,</span>
                         <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_policy</span><span class="p">:</span>
            <span class="n">intrp</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span>
                            <span class="n">sample_treatment_costs</span><span class="o">=</span><span class="n">treatment_costs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">feature_baseline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># continuous treatment, so apply a treatment level 10% of typical</span>
                <span class="n">treatment_level</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">treatment_value</span> <span class="o">*</span> <span class="mf">0.1</span>

                <span class="c1"># NOTE: this calculation is correct only if treatment costs are marginal costs,</span>
                <span class="c1">#       because then scaling the difference between treatment value and treatment costs is the</span>
                <span class="c1">#       same as scaling the treatment value and subtracting the scaled treatment cost.</span>
                <span class="c1">#</span>
                <span class="c1">#       Note also that unlike the standard outputs of the SinglePolicyTreeInterpreter, for</span>
                <span class="c1">#       continuous treatments, the policy value should include the benefit of decreasing treatments</span>
                <span class="c1">#       (rather than just not treating at all)</span>
                <span class="c1">#</span>
                <span class="c1">#       We can get the total by seeing that if we restrict attention to units where we would treat,</span>
                <span class="c1">#         2 * policy_value - always_treat</span>
                <span class="c1">#       includes exactly their contribution because policy_value and always_treat both include it</span>
                <span class="c1">#       and likewise restricting attention to the units where we want to decrease treatment,</span>
                <span class="c1">#         2 * policy_value - always-treat</span>
                <span class="c1">#       also computes the *benefit* of decreasing treatment, because their contribution to policy_value</span>
                <span class="c1">#       is zero and the contribution to always_treat is negative</span>
                <span class="n">treatment_total</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">intrp</span><span class="o">.</span><span class="n">policy_value_</span> <span class="o">-</span> <span class="n">intrp</span><span class="o">.</span><span class="n">always_treat_value_</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">*</span> <span class="n">treatment_level</span>
                <span class="n">always_totals</span> <span class="o">=</span> <span class="n">intrp</span><span class="o">.</span><span class="n">always_treat_value_</span> <span class="o">*</span> <span class="n">treatment_level</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">treatment_total</span> <span class="o">=</span> <span class="n">intrp</span><span class="o">.</span><span class="n">policy_value_</span>
                <span class="n">always_totals</span> <span class="o">=</span> <span class="n">intrp</span><span class="o">.</span><span class="n">always_treat_value_</span>

            <span class="n">policy_values</span> <span class="o">=</span> <span class="n">treatment_total</span><span class="p">,</span> <span class="n">always_totals</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># no policy values for CATE trees</span>
            <span class="n">intrp</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">)</span>
            <span class="n">policy_values</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">intrp</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">X_transformer</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names_</span><span class="p">),</span> <span class="n">treatment_names</span><span class="p">,</span> <span class="n">policy_values</span>

    <span class="c1"># TODO: it seems like it would be better to just return the tree itself rather than plot it;</span>
    <span class="c1">#       however, the tree can&#39;t store the feature and treatment names we compute here...</span>
<div class="viewcode-block" id="CausalAnalysis.plot_policy_tree">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.plot_policy_tree">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_policy_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">treatment_costs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_value_increase</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">include_model_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a recommended policy tree using matplotlib.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            Features</span>
<span class="sd">        feature_index</span>
<span class="sd">            Index of the feature to be considered as treament</span>
<span class="sd">        treatment_costs: array_like, default 0</span>
<span class="sd">            Cost of treatment, as a scalar value or per-sample. For continuous features this is the marginal cost per</span>
<span class="sd">            unit of treatment; for discrete features, this is the difference in cost between each of the non-default</span>
<span class="sd">            values and the default value (i.e., if non-scalar the array should have shape (n,d_t-1))</span>
<span class="sd">        max_depth : int, default 3</span>
<span class="sd">            maximum depth of the tree</span>
<span class="sd">        min_samples_leaf : int, default 2</span>
<span class="sd">            minimum number of samples on each leaf</span>
<span class="sd">        min_value_increase : float, default 1e-4</span>
<span class="sd">            The minimum increase in the policy value that a split needs to create to construct it</span>
<span class="sd">        include_model_uncertainty : bool, default False</span>
<span class="sd">            Whether to include confidence interval information when building a simplified model of the cate model.</span>
<span class="sd">        alpha : float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals displayed in the leaf nodes.</span>
<span class="sd">            A (1-alpha)*100% confidence interval is displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intrp</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">treatment_names</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span>
                                                              <span class="n">treatment_costs</span><span class="o">=</span><span class="n">treatment_costs</span><span class="p">,</span>
                                                              <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                                                              <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                                                              <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">min_value_increase</span><span class="p">,</span>
                                                              <span class="n">include_model_uncertainty</span><span class="o">=</span><span class="n">include_model_uncertainty</span><span class="p">,</span>
                                                              <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">intrp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">treatment_names</span><span class="o">=</span><span class="n">treatment_names</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_policy_tree_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">treatment_costs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_value_increase</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a tuple of policy outputs.</span>

<span class="sd">        The first item in the tuple is the recommended policy tree expressed as a dictionary.</span>
<span class="sd">        The second item is the per-unit-average value of applying the learned policy; if the feature is continuous this</span>
<span class="sd">        means the gain from increasing the treatment by 10% of the typical amount for units where the treatment should</span>
<span class="sd">        be increased and decreasing the treatment by 10% of the typical amount when not.</span>
<span class="sd">        The third item is the value of always treating.  This is a list, with one entry per non-control-treatment for</span>
<span class="sd">        discrete features, or just a single entry for continuous features, again increasing by 10% of a typical amount.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            Features</span>
<span class="sd">        feature_index</span>
<span class="sd">            Index of the feature to be considered as treament</span>
<span class="sd">        treatment_costs: array_like, default 0</span>
<span class="sd">            Cost of treatment, as a scalar value or per-sample. For continuous features this is the marginal cost per</span>
<span class="sd">            unit of treatment; for discrete features, this is the difference in cost between each of the non-default</span>
<span class="sd">            values and the default value (i.e., if non-scalar the array should have shape (n,d_t-1))</span>
<span class="sd">        max_depth : int, default 3</span>
<span class="sd">            maximum depth of the tree</span>
<span class="sd">        min_samples_leaf : int, default 2</span>
<span class="sd">            minimum number of samples on each leaf</span>
<span class="sd">        min_value_increase : float, default 1e-4</span>
<span class="sd">            The minimum increase in the policy value that a split needs to create to construct it</span>
<span class="sd">        alpha : float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals displayed in the leaf nodes.</span>
<span class="sd">            A (1-alpha)*100% confidence interval is displayed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output : _PolicyOutput</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">intrp</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">treatment_names</span><span class="p">,</span>
            <span class="p">(</span><span class="n">policy_val</span><span class="p">,</span> <span class="n">always_trt</span><span class="p">))</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span>
                                                   <span class="n">treatment_costs</span><span class="o">=</span><span class="n">treatment_costs</span><span class="p">,</span>
                                                   <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                                                   <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                                                   <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">min_value_increase</span><span class="p">,</span>
                                                   <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">policy_data</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">node_dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;treatment&#39;</span><span class="p">:</span> <span class="n">treatment_names</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">node_id</span><span class="p">])]}</span>
        <span class="k">return</span> <span class="n">_PolicyOutput</span><span class="p">(</span><span class="n">_tree_interpreter_to_dict</span><span class="p">(</span><span class="n">intrp</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">policy_data</span><span class="p">),</span>
                             <span class="n">policy_val</span><span class="p">,</span>
                             <span class="p">{</span><span class="n">treatment_names</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span> <span class="n">val</span>
                              <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">always_trt</span><span class="o">.</span><span class="n">tolist</span><span class="p">())},</span>
                             <span class="n">treatment_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># TODO: it seems like it would be better to just return the tree itself rather than plot it;</span>
    <span class="c1">#       however, the tree can&#39;t store the feature and treatment names we compute here...</span>
<div class="viewcode-block" id="CausalAnalysis.plot_heterogeneity_tree">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.plot_heterogeneity_tree">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_heterogeneity_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                                <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
                                <span class="n">include_model_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot an effect heterogeneity tree using matplotlib.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            Features</span>
<span class="sd">        feature_index</span>
<span class="sd">            Index of the feature to be considered as treament</span>
<span class="sd">        max_depth : int, default 3</span>
<span class="sd">            maximum depth of the tree</span>
<span class="sd">        min_samples_leaf : int, default 2</span>
<span class="sd">            minimum number of samples on each leaf</span>
<span class="sd">        min_impurity_decrease : float, default 1e-4</span>
<span class="sd">            The minimum decrease in the impurity/uniformity of the causal effect that a split needs to</span>
<span class="sd">            achieve to construct it</span>
<span class="sd">        include_model_uncertainty : bool, default False</span>
<span class="sd">            Whether to include confidence interval information when building a simplified model of the cate model.</span>
<span class="sd">        alpha : float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals displayed in the leaf nodes.</span>
<span class="sd">            A (1-alpha)*100% confidence interval is displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intrp</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">treatment_names</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span>
                                                              <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                                                              <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                                                              <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">min_impurity_decrease</span><span class="p">,</span>
                                                              <span class="n">include_model_uncertainty</span><span class="o">=</span><span class="n">include_model_uncertainty</span><span class="p">,</span>
                                                              <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">intrp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span>
                          <span class="n">treatment_names</span><span class="o">=</span><span class="n">treatment_names</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_heterogeneity_tree_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                                   <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
                                   <span class="n">include_model_uncertainty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an effect heterogeneity tree expressed as a dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X : array_like</span>
<span class="sd">            Features</span>
<span class="sd">        feature_index</span>
<span class="sd">            Index of the feature to be considered as treament</span>
<span class="sd">        max_depth : int, default 3</span>
<span class="sd">            maximum depth of the tree</span>
<span class="sd">        min_samples_leaf : int, default 2</span>
<span class="sd">            minimum number of samples on each leaf</span>
<span class="sd">        min_impurity_decrease : float, default 1e-4</span>
<span class="sd">            The minimum decrease in the impurity/uniformity of the causal effect that a split needs to</span>
<span class="sd">            achieve to construct it</span>
<span class="sd">        include_model_uncertainty : bool, default False</span>
<span class="sd">            Whether to include confidence interval information when building a simplified model of the cate model.</span>
<span class="sd">        alpha : float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals displayed in the leaf nodes.</span>
<span class="sd">            A (1-alpha)*100% confidence interval is displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intrp</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span>
                                                <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
                                                <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
                                                <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">min_impurity_decrease</span><span class="p">,</span>
                                                <span class="n">include_model_uncertainty</span><span class="o">=</span><span class="n">include_model_uncertainty</span><span class="p">,</span>
                                                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">hetero_data</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">node_dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">include_model_uncertainty</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;effect&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">node_id</span><span class="p">]),</span>
                        <span class="s1">&#39;ci&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="n">node_dict</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;ci&#39;</span><span class="p">])}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;effect&#39;</span><span class="p">:</span> <span class="n">_sanitize</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">node_id</span><span class="p">])}</span>
        <span class="k">return</span> <span class="n">_tree_interpreter_to_dict</span><span class="p">(</span><span class="n">intrp</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">,</span> <span class="n">hetero_data</span><span class="p">)</span>

<div class="viewcode-block" id="CausalAnalysis.individualized_policy">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.individualized_policy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">individualized_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">treatment_costs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get individualized treatment policy based on the learned model for a feature, sorted by the predicted effect.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Xtest: array_like</span>
<span class="sd">            Features</span>
<span class="sd">        feature_index: int or str</span>
<span class="sd">            Index of the feature to be considered as treatment</span>
<span class="sd">        n_rows: int, optional</span>
<span class="sd">            How many rows to return (all rows by default)</span>
<span class="sd">        treatment_costs: array_like, default 0</span>
<span class="sd">            Cost of treatment, as a scalar value or per-sample. For continuous features this is the marginal cost per</span>
<span class="sd">            unit of treatment; for discrete features, this is the difference in cost between each of the non-default</span>
<span class="sd">            values and the default value (i.e., if non-scalar the array should have shape (n,d_t-1))</span>
<span class="sd">        alpha: float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals</span>
<span class="sd">            A (1-alpha)*100% confidence interval is returned</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output: DataFrame</span>
<span class="sd">            Dataframe containing recommended treatment, effect, confidence interval, sorted by effect</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_result_index</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">)</span>

        <span class="c1"># get dataframe with all but selected column</span>
        <span class="n">orig_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names_</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_names_</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">feature_index</span><span class="p">]:</span> <span class="s1">&#39;Current treatment&#39;</span><span class="p">})</span>

        <span class="n">Xtest</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">X_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x_rows</span> <span class="o">=</span> <span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Xtest</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">feature_baseline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># apply 10% of a typical treatment for this feature</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">effect_inference</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">T1</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">treatment_value</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">const_marginal_effect_inference</span><span class="p">(</span><span class="n">Xtest</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Xtest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># we got a scalar effect although our original X may have had more rows</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="n">effect</span><span class="o">.</span><span class="n">_expand_outputs</span><span class="p">(</span><span class="n">x_rows</span><span class="p">)</span>

        <span class="n">multi_y</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vec_y</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification</span>

        <span class="k">if</span> <span class="n">multi_y</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">feature_baseline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">treatment_costs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># we&#39;ve got treatment costs of shape (n, d_t-1) so we need to add a y dimension to broadcast safely</span>
            <span class="n">treatment_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">treatment_costs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">effect</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="n">treatment_costs</span><span class="p">)</span>

        <span class="n">est</span> <span class="o">=</span> <span class="n">effect</span><span class="o">.</span><span class="n">point_estimate</span>
        <span class="n">est_lb</span> <span class="o">=</span> <span class="n">effect</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">est_ub</span> <span class="o">=</span> <span class="n">effect</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">multi_y</span><span class="p">:</span>  <span class="c1"># y was an array, not a vector</span>
            <span class="n">est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">est_lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">est_lb</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">est_ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">est_ub</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">feature_baseline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">est</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
            <span class="n">rec</span><span class="p">[</span><span class="n">est</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;increase&quot;</span>
            <span class="n">rec</span><span class="p">[</span><span class="n">est</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;decrease&quot;</span>
            <span class="c1"># set the effect bounds; for positive treatments these agree with</span>
            <span class="c1"># the estimates; for negative treatments, we need to invert the interval</span>
            <span class="n">eff_lb</span><span class="p">,</span> <span class="n">eff_ub</span> <span class="o">=</span> <span class="n">est_lb</span><span class="p">,</span> <span class="n">est_ub</span>
            <span class="n">eff_lb</span><span class="p">[</span><span class="n">est</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">eff_ub</span><span class="p">[</span><span class="n">est</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">eff_ub</span><span class="p">[</span><span class="n">est</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">eff_lb</span><span class="p">[</span><span class="n">est</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># the effect is now always positive since we decrease treatment when negative</span>
            <span class="n">eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># for discrete treatment, stack a zero result in front for control</span>
            <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">est</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">all_effs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">zeros</span><span class="p">,</span> <span class="n">est</span><span class="p">])</span>
            <span class="n">eff_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">all_effs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">treatment_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">result</span><span class="o">.</span><span class="n">feature_baseline</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">lvl</span> <span class="k">for</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">feature_levels</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="n">treatment_arr</span><span class="p">[</span><span class="n">eff_ind</span><span class="p">]</span>
            <span class="c1"># we need to call effect_inference to get the correct CI between the two treatment options</span>
            <span class="n">effect</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">effect_inference</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;Current treatment&#39;</span><span class="p">],</span> <span class="n">T1</span><span class="o">=</span><span class="n">rec</span><span class="p">)</span>
            <span class="c1"># we now need to construct the delta in the cost between the two treatments and translate the effect</span>
            <span class="n">current_treatment</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[</span><span class="s1">&#39;Current treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_treatment</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrays</span><span class="o">.</span><span class="n">categorical</span><span class="o">.</span><span class="n">Categorical</span><span class="p">):</span>
                <span class="n">current_treatment</span> <span class="o">=</span> <span class="n">current_treatment</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">treatment_costs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># remove third dimenions potentially added</span>
                <span class="k">if</span> <span class="n">multi_y</span><span class="p">:</span>  <span class="c1"># y was an array, not a vector</span>
                    <span class="n">treatment_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">treatment_costs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">treatment_costs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">treatment_arr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;If treatment costs are an array, &quot;</span>
                                                                            <span class="s2">&quot; they must be of shape (n, d_t-1),&quot;</span>
                                                                            <span class="s2">&quot; where n is the number of samples&quot;</span>
                                                                            <span class="s2">&quot; and d_t the number of treatment&quot;</span>
                                                                            <span class="s2">&quot; categories.&quot;</span><span class="p">)</span>
                <span class="n">all_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">zeros</span><span class="p">,</span> <span class="n">treatment_costs</span><span class="p">])</span>
                <span class="c1"># find cost of current treatment: equality creates a 2d array with True on each row,</span>
                <span class="c1"># only if its the location of the current treatment. Then we take the corresponding cost.</span>
                <span class="n">current_cost</span> <span class="o">=</span> <span class="n">all_costs</span><span class="p">[</span><span class="n">current_treatment</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">treatment_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
                <span class="n">target_cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">all_costs</span><span class="p">,</span> <span class="n">eff_ind</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">treatment_costs</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span> <span class="p">(</span><span class="s2">&quot;Treatments costs should either be float or &quot;</span>
                                                                   <span class="s2">&quot;a 2d array of size (n, d_t-1).&quot;</span><span class="p">)</span>
                <span class="n">all_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">treatment_costs</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">treatment_arr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="c1"># construct index of current treatment</span>
                <span class="n">current_ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_treatment</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span>
                               <span class="n">treatment_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">treatment_arr</span><span class="p">))</span>
                <span class="n">current_cost</span> <span class="o">=</span> <span class="n">all_costs</span><span class="p">[</span><span class="n">current_ind</span><span class="p">]</span>
                <span class="n">target_cost</span> <span class="o">=</span> <span class="n">all_costs</span><span class="p">[</span><span class="n">eff_ind</span><span class="p">]</span>
            <span class="n">delta_cost</span> <span class="o">=</span> <span class="n">current_cost</span> <span class="o">-</span> <span class="n">target_cost</span>
            <span class="c1"># add second dimension if needed for broadcasting during translation of effect</span>
            <span class="k">if</span> <span class="n">multi_y</span><span class="p">:</span>
                <span class="n">delta_cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">delta_cost</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">effect</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">delta_cost</span><span class="p">)</span>
            <span class="n">eff</span> <span class="o">=</span> <span class="n">effect</span><span class="o">.</span><span class="n">point_estimate</span>
            <span class="n">eff_lb</span><span class="p">,</span> <span class="n">eff_ub</span> <span class="o">=</span> <span class="n">effect</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">multi_y</span><span class="p">:</span>  <span class="c1"># y was an array, not a vector</span>
                <span class="n">eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">eff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">eff_lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">eff_lb</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">eff_ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">eff_ub</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Treatment&#39;</span><span class="p">:</span> <span class="n">rec</span><span class="p">,</span>
                           <span class="s1">&#39;Effect of treatment&#39;</span><span class="p">:</span> <span class="n">eff</span><span class="p">,</span>
                           <span class="s1">&#39;Effect of treatment lower bound&#39;</span><span class="p">:</span> <span class="n">eff_lb</span><span class="p">,</span>
                           <span class="s1">&#39;Effect of treatment upper bound&#39;</span><span class="p">:</span> <span class="n">eff_ub</span><span class="p">},</span>
                          <span class="n">index</span><span class="o">=</span><span class="n">orig_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orig_df</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Effect of treatment&#39;</span><span class="p">,</span>
                                            <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_individualized_policy_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">treatment_costs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get individualized treatment policy based on the learned model for a feature, sorted by the predicted effect.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Xtest: array_like</span>
<span class="sd">            Features</span>
<span class="sd">        feature_index: int or str</span>
<span class="sd">            Index of the feature to be considered as treatment</span>
<span class="sd">        n_rows: int, optional</span>
<span class="sd">            How many rows to return (all rows by default)</span>
<span class="sd">        treatment_costs: array_like, default 0</span>
<span class="sd">            Cost of treatment, as a scalar value or per-sample</span>
<span class="sd">        alpha: float in [0, 1], default 0.05</span>
<span class="sd">            Confidence level of the confidence intervals</span>
<span class="sd">            A (1-alpha)*100% confidence interval is returned</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output: dictionary</span>
<span class="sd">            dictionary containing treatment policy, effects, and other columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">individualized_policy</span><span class="p">(</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">,</span>
                                          <span class="n">n_rows</span><span class="o">=</span><span class="n">n_rows</span><span class="p">,</span>
                                          <span class="n">treatment_costs</span><span class="o">=</span><span class="n">treatment_costs</span><span class="p">,</span>
                                          <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CausalAnalysis.typical_treatment_value">
<a class="viewcode-back" href="../../../../_autosummary/econml.solutions.causal_analysis.CausalAnalysis.html#econml.solutions.causal_analysis.CausalAnalysis.typical_treatment_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">typical_treatment_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the typical treatment value used for the specified feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature_index: int or str</span>
<span class="sd">            The index of the feature to be considered as treatment</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        treatment_value : float</span>
<span class="sd">            The treatment value considered &#39;typical&#39; for this feature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">feature_index</span> <span class="o">==</span> <span class="n">feature_index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_column_names</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">feature_name</span> <span class="o">==</span> <span class="n">feature_index</span><span class="p">]</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Could not find feature with index/name </span><span class="si">{</span><span class="n">feature_index</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">treatment_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No feature with index </span><span class="si">{</span><span class="n">feature_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">treatment_value</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, PyWhy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>